import{V as c,S as F,at as P,au as W,ap as q,an as T,av as j,M as H}from"./vendor-1f431ae3.js";import{t as L}from"./transformPositionToVector3-0d134797.js";function z(n,e){const u=Math.round(n);return u%2===0?u:u+Number(e?.smaller?-1:1)}function N(n,e){return new c((n.x+e.x)/2,(n.y+e.y)/2,(n.z+e.z)/2)}function V(n,e){if(!e||typeof ResizeObserver>"u")return{observe:()=>window.addEventListener("resize",n),unobserve:()=>window.removeEventListener("resize",n)};{const u=new ResizeObserver(n);return{observe:()=>u.observe(e),unobserve:()=>u.unobserve(e)}}}const Y=n=>{const e={disposeCallbacks:[]},u=(...t)=>{const M=t[0].map(i=>i instanceof c?i:L(i)),s=t[1];if(M?.length<4)return console.error("points must be equal or greater than than 4");if(!n?.model?.loaded)return console.error("five.model.loaded is: ",n?.model?.loaded);const a=n.getElement();if(!a)return console.error("five.getElement() is "+a);const f=[],x=s?.ratio||.00216;x<=.00215&&console.warn("if you need click css3DElement on safari, ratio must be greater than 0.00215");const D=s?.dpr||1,l=s?.mode||"front",v=s?.autoRender??!0,C=s?.behindFiveContainer||a.parentElement||document.body,r=s?.container||document.createElement("div");r.classList.add("__Dnalogel-plugin--CSS3DRenderPlugin");const{css3DObject:b,mesh:o}=k(M,{ratio:x,dpr:D,container:r,mode:l});let h;const y=l==="front"&&!e.frontMode,g=l==="behind"&&!e.behindMode,A=!(y||g);g&&(e.behindMode={scene:new F,css3DRenderer:new P}),y&&(e.frontMode={scene:new F,css3DRenderer:new P});const w=l==="behind"?e.behindMode:e.frontMode,{scene:p,css3DRenderer:d}=w,m=(()=>{if(A)return()=>{p.add(b)};{const i=()=>{const R=z(a.clientWidth,{smaller:!0}),I=z(a.clientHeight,{smaller:!0});d.setSize(R,I)};i(),h=V(i,a),d.domElement.style.position="absolute",d.domElement.style.top="0",d.domElement.style.userSelect="none",d.domElement.style.pointerEvents="none";const O=()=>{const R=requestAnimationFrame(O);w.requestAnimationFrameId=R,d.render(p,n.camera)};return()=>{p.add(b),h?.observe?.(),O(),l==="behind"&&o&&(n.scene.add(o),f.push(()=>o&&n.scene.remove(o)))}}})();y&&(a.parentElement||document.body).appendChild(d.domElement),g&&C.appendChild(d.domElement);const E=()=>(f.forEach(i=>i?.()),p.remove(b),p.children.length===0&&(typeof w.requestAnimationFrameId=="number"&&cancelAnimationFrame(w.requestAnimationFrameId),d.domElement.remove(),l==="front"&&(e.frontMode=void 0),l==="behind"&&(e.behindMode=void 0),!e.behindMode&&!e.frontMode&&h?.unobserve?.()),!0),S=e.disposeCallbacks.findIndex(i=>i===E);return S!==-1?e.disposeCallbacks.splice(S,1):e.disposeCallbacks.push(E),v&&m(),{container:r,dispose:E,css3DObject:b,render:v?void 0:m}},k=(t,M)=>{const{ratio:s,dpr:a,container:f,mode:x}=M,D=t[0].distanceTo(t[1]),l=t[1].distanceTo(t[2]),v=z(D/s*a),C=z(l/s*a),r=new W(f);r.scale.set(s,s,s),f.style.width=v+"px",f.style.height=C+"px",f.style.pointerEvents="none";const b=N(t[0],t[2]),o=t[1].clone().sub(t[0]),h=t[2].clone().sub(t[1]),y=new c(0,1,0).angleTo(new c(0,h.y,h.z)),g=new c(1,0,0).angleTo(new c(o.x,0,o.z)),A=o.angleTo(new c(o.x,0,o.z)),w=(h.z>0?-1:1)*y,p=(o.z<0?1:-1)*g,d=(o.x>0&&o.y<0||o.x<0&&o.y>0?-1:1)*A;r.rotateOnWorldAxis(new c(1,0,0),w),r.rotateOnWorldAxis(new c(0,1,0),p),r.rotateOnWorldAxis(new c(0,0,1),d),r.position.set(b.x,b.y,b.z);let m;if(x==="behind"){const E=new q({opacity:0,transparent:!1,side:T}),S=new j(v,C);m=new H(S,E),m.name="CSS3DRenderPlugin-mesh",m.position.copy(r.position),m.rotation.copy(r.rotation),m.scale.copy(r.scale)}return{css3DObject:r,mesh:m}};return{create3DDomContainer:u,disposeAll:()=>{e.disposeCallbacks.forEach(t=>t?.()),e.disposeCallbacks=[]}}};export{Y as C};
