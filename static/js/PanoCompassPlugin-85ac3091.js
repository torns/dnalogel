import{u as f,D as y}from"./useFetchDatas-b277a088.js";import{G as C,V as c,aB as b,aq as p,M as m,av as E,r as v,a as D,a9 as B,c as w,d as P,p as k,j as d,e as M,B as S,$ as R}from"./vendor-b2bf1e8d.js";import{t as Q,l as A}from"./typings-ddaad332.js";import{C as x}from"./index-1bd943cc.js";import"./transformPositionToVector3-27356c9f.js";const T="data:image/png;base64,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";function j(){const t=document.createElement("div"),e=document.createElement("i"),o=document.createElement("span");return t.appendChild(e),t.appendChild(o),t.style.position="relative",t.style.width="100%",t.style.display="flex",t.style.flexDirection="column",t.style.alignItems="center",t.style.marginTop=`${150/16}rem`,t.style.opacity="0",t.style.transition="opacity 1000ms linear",e.style.display="block",e.style.width=`${134/16}rem`,e.style.height=`${22/16}rem`,e.style.backgroundSize="100%",e.style.backgroundRepeat="no-repeat",e.style.backgroundImage=`url(${T})`,o.style.marginTop=`${10/16}rem`,o.style.fontSize=`${16/16}rem`,o.style.color="#fff",o.style.opacity="0.7",o.style.textShadow="0 2px 16px rgb(22 34 83 / 24%)",o.style.fontWeight="bold",{appendTo(i){i.appendChild(t)},dispose(){t.remove()},setRoom(i){o.innerHTML=i.name+" "+Math.floor(i.size/1e6)+"\u33A1"},show(){t.style.opacity="1"},hide(){t.style.opacity="0"}}}const O=function(t,e){return new F(t,e)};class F{constructor(e,o){Object.defineProperty(this,"five",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"group",{enumerable:!0,configurable:!0,writable:!0,value:new C}),Object.defineProperty(this,"modelLoaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"roomInfoInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"roomInfoWrapperInstance",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"compassMeshTween",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"compassMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entryDoorMesh",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dispose",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var i,n,s,r;this.five.scene.remove(this.group),this.group.remove(...this.group.children),(n=(i=this.compassMesh)===null||i===void 0?void 0:i.material.map)===null||n===void 0||n.dispose(),(r=(s=this.entryDoorMesh)===null||s===void 0?void 0:s.material.map)===null||r===void 0||r.dispose(),this.five.off("panoArrived",this.onFivePanoArrived),this.five.off("panoWillArrive",this.onFivePanoWillArrive)}}),Object.defineProperty(this,"onFiveFistPanoLoaded",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.modelLoaded=!0,this.data&&this.init()}}),Object.defineProperty(this,"onFivePanoWillArrive",{enumerable:!0,configurable:!0,writable:!0,value:i=>{var n,s;i!==this.five.panoIndex&&((n=this.compassMeshTween)===null||n===void 0||n.dispose(),(s=this.compassMesh)===null||s===void 0||s.material.setValues({opacity:0}))}}),Object.defineProperty(this,"onFivePanoArrived",{enumerable:!0,configurable:!0,writable:!0,value:i=>{var n,s,r,h;const a=this.five.work.observers[i].standingPosition;if(this.compassMesh){if(this.compassMesh.position.copy(a.clone().setY(a.y+.01)),this.compassMesh.material.opacity!==0)return;(n=this.compassMeshTween)===null||n===void 0||n.dispose(),this.compassMeshTween=Q(1e3).onUpdate(({progress:u})=>{var l;(l=this.compassMesh)===null||l===void 0||l.material.setValues({opacity:u}),this.five.needsRender=!0}).play()}if(this.entryDoorMesh){const l=new c(this.data.entrance.position.x,this.data.entrance.position.y,this.data.entrance.position.z).clone().setY(a.y).sub(a).normalize(),g=a.clone().add(l.clone().multiplyScalar(.7)).setY(a.y+.01);this.entryDoorMesh.rotation.z=new c(0,0,-1).angleTo(l),this.entryDoorMesh.position.copy(g),((s=this.data)===null||s===void 0?void 0:s.room_observers[i].room.type)===1?(r=this.entryDoorMesh)===null||r===void 0||r.material.setValues({opacity:1}):(h=this.entryDoorMesh)===null||h===void 0||h.material.setValues({opacity:0})}this.roomInfoInstance&&this.roomInfoWrapperInstance&&(this.roomInfoWrapperInstance.css3DObject.position.copy(a.clone().setY(a.y+.01)),this.roomInfoInstance.setRoom(this.data.room_observers[i].room)),this.five.needsRender=!0}}),Object.defineProperty(this,"onFiveCameraDirectionUpdate",{enumerable:!0,configurable:!0,writable:!0,value:({longitude:i,latitude:n})=>{var s,r;!this.roomInfoWrapperInstance||(this.roomInfoWrapperInstance.css3DObject.rotation.z=i,n>.66&&this.five.getCurrentState().mode==="Panorama"?(s=this.roomInfoInstance)===null||s===void 0||s.show():(r=this.roomInfoInstance)===null||r===void 0||r.hide())}}),this.five=e,this.config=o,this.five.scene.add(this.group),e.once("dispose",this.dispose),e.once("modelLoaded",this.onFiveFistPanoLoaded),this.five.on("panoArrived",this.onFivePanoArrived),this.five.on("panoWillArrive",this.onFivePanoWillArrive),this.five.on("cameraDirectionUpdate",this.onFiveCameraDirectionUpdate)}load(e){this.data=e,this.modelLoaded&&this.init()}async init(){if(!this.data||!this.modelLoaded)return;const e=this.data.north_rad;e!=null&&(this.compassMesh=await this.loadCompassMesh(),this.compassMesh.rotateX(-Math.PI/2),this.compassMesh.rotateZ(e-Math.PI/2),this.group.add(this.compassMesh)),this.data.entrance!=null&&(this.entryDoorMesh=await this.loadEntryDoorMesh(),this.roomInfoWrapperInstance=this.loadRoomInfo(),this.roomInfoInstance=j(),this.entryDoorMesh.rotateX(-Math.PI/2),this.roomInfoWrapperInstance&&this.roomInfoInstance.appendTo(this.roomInfoWrapperInstance.container),this.group.add(this.entryDoorMesh)),this.onFivePanoArrived(this.five.panoIndex||0),this.five.needsRender=!0}async loadCompassMesh(){var e;const o=((e=this.config)===null||e===void 0?void 0:e.compassImageUrl)||"//vrlab-image4.ljcdn.com/release/web/v3/north-point-circle.96498e69.png",i=await A(o),n=new b(.7,32),s=new p({map:i,transparent:!0,opacity:0,depthTest:!1}),r=new m(n,s);return r.name="pano-compass-mesh",r}async loadEntryDoorMesh(){var e;const o=((e=this.config)===null||e===void 0?void 0:e.entryDoorImageUrl)||"//vrlab-image4.ljcdn.com/release/web/enterDoor.831b8208.png",i=await A(o),n=new E(.2,.16),s=new p({map:i,transparent:!0,opacity:.8,depthTest:!1}),r=new m(n,s);return r.name="pano-compass-entry-door",r}loadRoomInfo(){const e=[new c(-.7,0,-.7),new c(.7,0,-.7),new c(.7,0,.7),new c(-.7,0,.7)];return x(this.five).create3DDomContainer(e)}}function I(){return{width:window.innerWidth,height:window.innerHeight}}function Y(){const[t,e]=v.exports.useState(I);return v.exports.useEffect(()=>{const o=()=>e(I());return window.addEventListener("resize",o,!1),()=>window.removeEventListener("resize",o,!1)}),t}const U=()=>{const t=D(),e=f(y.FLOOR_PLAN_SERVER_PLUGIN_DATA);return B("modelLoaded",async()=>{if(!e||JSON.stringify(e)==="{}")return;const o=e?.computed_data?.entrance?.north_rad;await t.plugins.panoCompassPlugin.load({north_rad:o})},[e]),null},W=w({imageOptions:{size:512},textureOptions:{size:512},onlyRenderIfNeeds:!0,plugins:[[O,"panoCompassPlugin",{}]]}),N=()=>{const t=Y(),e=f(y.WORK);return e&&P(W,{initialWork:k(e),ref:o=>Object.assign(window,{$five:o?.five}),children:[d(M,{...t}),d(S,{className:"plugin-full-screen-container",sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),d(U,{})]})};R.render(d(N,{}),document.querySelector("#app"));
