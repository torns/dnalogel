import{u as Z,D as $}from"./useFetchDatas-b277a088.js";import{h as W,i as M,k as H,l as L,m as w,n as x,o as d,q as j,t as y,v as F,w as O,x as ee,y as re,z as R,E as ae,H as oe,I as U,J as D,K as E,L as z,N as h,Q as v,R as k,U as ie,X as te,Y as ne,Z as le,_ as se,r as I,u as fe,a as ue,F as N,j as A,B as ce,c as pe,d as me,p as de,e as ge,$ as he}from"./vendor-b2bf1e8d.js";import"./typings-ddaad332.js";import{C as q,a as be,b as ve,f as _e,c as B}from"./RoomHighlight-ba554c03.js";import{t as we}from"./throttle-19b08aa2.js";import{g as xe}from"./getInitialParamFromUrl-141e6748.js";function je(r){L(r,"svelte-o7uo2v",".plugin-radar__camera-wrapper.svelte-o7uo2v{width:100%;height:100%;position:absolute;pointer-events:none}.plugin-radar__camera-position.svelte-o7uo2v{position:absolute;left:0;top:0;width:0;height:0;transform:none;pointer-events:none;transition:transform 1s linear}.plugin-radar__camera-rotate.svelte-o7uo2v{position:absolute;left:-15px;top:-15px;width:17px;height:17px;transform-origin:15px 15px;transform:rotate(45deg);background-repeat:no-repeat;background-size:100%}")}function Oe(r){let e,t,n;return{c(){e=w("div"),t=w("div"),n=w("div"),x(n,"class","plugin-radar__camera-rotate svelte-o7uo2v"),d(n,"background-image","url("+(r[0]||q)+")"),d(n,"transform",r[1],!1),x(t,"class","plugin-radar__camera-position svelte-o7uo2v"),d(t,"transform",r[2],!1),x(e,"class","plugin-radar__camera-wrapper svelte-o7uo2v")},m(a,o){j(a,e,o),y(e,t),y(t,n)},p(a,[o]){o&1&&d(n,"background-image","url("+(a[0]||q)+")"),o&2&&d(n,"transform",a[1],!1),o&4&&d(t,"transform",a[2],!1)},i:F,o:F,d(a){a&&O(e)}}}function Ie(r,e,t){let{five:n}=e,{pxmm:a}=e,{floorplanData:o}=e,{cameraImageUrl:i}=e;function c(m){const b=o.observers[m],_=o.bounding,g=(_.max.x-_.min.x)*a,S=(_.max.y-_.min.y)*a;if(!b)return"";const C=Math.floor(b.positionInImage.x*g),P=Math.floor(b.positionInImage.y*S);return`translate(${C}px, ${P}px)`}function p(){const{longitude:m}=n.getCurrentState();return`rotate(${Math.floor(m/Math.PI*180)*-1+45}deg)`}const s=m=>{t(2,f=c(m))},l=we(()=>{t(1,u=p())},1e3/60);let u=p(),f=c(n.getCurrentState().panoIndex);return ee(()=>{n.on("panoWillArrive",s),n.on("cameraDirectionUpdate",l)}),re(()=>{n.off("panoWillArrive",s),n.off("cameraDirectionUpdate",l)}),r.$$set=m=>{"five"in m&&t(3,n=m.five),"pxmm"in m&&t(4,a=m.pxmm),"floorplanData"in m&&t(5,o=m.floorplanData),"cameraImageUrl"in m&&t(0,i=m.cameraImageUrl)},[i,u,f,n,a,o]}class Pe extends W{constructor(e){super();M(this,e,Ie,Oe,H,{five:3,pxmm:4,floorplanData:5,cameraImageUrl:0},je)}}function ye(r){L(r,"svelte-8n0d4v",".plugin-pano-floorplan__extra-objects.svelte-8n0d4v{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.plugin-pano-floorplan__extra-object-item--position.svelte-8n0d4v{position:absolute;width:0;height:0}.plugin-pano-floorplan__extra-object-item.svelte-8n0d4v{transform:translate(-50%, -50%)}")}function G(r,e,t){const n=r.slice();return n[1]=e[t],n}function K(r,e){let t,n,a=`${e[1].icon.width/16}rem`,o=`${e[1].icon.height/16}rem`,i,c=`${e[1].positionInImage.y*100}%`,p=`${e[1].positionInImage.x*100}%`;return{key:r,first:null,c(){t=w("div"),n=w("div"),i=R(),x(n,"class","plugin-pano-floorplan__extra-object-item svelte-8n0d4v"),d(n,"background-image",`url(${e[1].icon.url})`),d(n,"width",a,!1),d(n,"height",o,!1),x(t,"class","plugin-pano-floorplan__extra-object-item--position svelte-8n0d4v"),d(t,"top",c,!1),d(t,"left",p,!1),this.first=t},m(s,l){j(s,t,l),y(t,n),y(t,i)},p(s,l){e=s,l&1&&d(n,"background-image",`url(${e[1].icon.url})`),l&1&&a!==(a=`${e[1].icon.width/16}rem`)&&d(n,"width",a,!1),l&1&&o!==(o=`${e[1].icon.height/16}rem`)&&d(n,"height",o,!1),l&1&&c!==(c=`${e[1].positionInImage.y*100}%`)&&d(t,"top",c,!1),l&1&&p!==(p=`${e[1].positionInImage.x*100}%`)&&d(t,"left",p,!1)},d(s){s&&O(t)}}}function De(r){let e,t=[],n=new Map,a=r[0];const o=i=>i[1].id;for(let i=0;i<a.length;i+=1){let c=G(r,a,i),p=o(c);n.set(p,t[i]=K(p,c))}return{c(){e=w("div");for(let i=0;i<t.length;i+=1)t[i].c();x(e,"class","plugin-pano-floorplan__extra-objects svelte-8n0d4v")},m(i,c){j(i,e,c);for(let p=0;p<t.length;p+=1)t[p].m(e,null)},p(i,[c]){c&1&&(a=i[0],t=ae(t,c,o,1,i,a,n,e,oe,K,null,G))},i:F,o:F,d(i){i&&O(e);for(let c=0;c<t.length;c+=1)t[c].d()}}}function Ee(r,e,t){let{extraObjects:n=[]}=e;return r.$$set=a=>{"extraObjects"in a&&t(0,n=a.extraObjects)},[n]}class ke extends W{constructor(e){super();M(this,e,Ee,De,H,{extraObjects:0},ye)}}function V(r){let e,t;const n=[{five:r[0],pxmm:r[1],floorIndex:r[2],floorplanData:r[4],onRoomHeightClick:r[6]}];let a={};for(let o=0;o<n.length;o+=1)a=U(a,n[o]);return e=new ve({props:a}),{c(){D(e.$$.fragment)},m(o,i){E(e,o,i),t=!0},p(o,i){const c=i&87?z(n,[{five:o[0],pxmm:o[1],floorIndex:o[2],floorplanData:o[4],onRoomHeightClick:o[6]}]):{};e.$set(c)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){v(e.$$.fragment,o),t=!1},d(o){k(e,o)}}}function Se(r){let e,t,n,a,o,i;const c=[{floorIndex:r[2],floorplanData:r[4]}];let p={};for(let l=0;l<c.length;l+=1)p=U(p,c[l]);e=new be({props:p}),n=new ke({props:{extraObjects:r[5]}});let s=r[3]&&V(r);return{c(){D(e.$$.fragment),t=R(),D(n.$$.fragment),a=R(),s&&s.c(),o=ie()},m(l,u){E(e,l,u),j(l,t,u),E(n,l,u),j(l,a,u),s&&s.m(l,u),j(l,o,u),i=!0},p(l,[u]){const f=u&20?z(c,[{floorIndex:l[2],floorplanData:l[4]}]):{};e.$set(f);const m={};u&32&&(m.extraObjects=l[5]),n.$set(m),l[3]?s?(s.p(l,u),u&8&&h(s,1)):(s=V(l),s.c(),h(s,1),s.m(o.parentNode,o)):s&&(te(),v(s,1,1,()=>{s=null}),ne())},i(l){i||(h(e.$$.fragment,l),h(n.$$.fragment,l),h(s),i=!0)},o(l){v(e.$$.fragment,l),v(n.$$.fragment,l),v(s),i=!1},d(l){k(e,l),l&&O(t),k(n,l),l&&O(a),s&&s.d(l),l&&O(o)}}}function Ce(r,e,t){let n,{five:a}=e,{pxmm:o}=e,{floorIndex:i}=e,{hoverEnable:c}=e,{floorplanData:p}=e,{extraObjects:s=[]}=e;const l=void 0;return r.$$set=u=>{"five"in u&&t(0,a=u.five),"pxmm"in u&&t(1,o=u.pxmm),"floorIndex"in u&&t(2,i=u.floorIndex),"hoverEnable"in u&&t(3,c=u.hoverEnable),"floorplanData"in u&&t(4,p=u.floorplanData),"extraObjects"in u&&t(7,s=u.extraObjects)},r.$$.update=()=>{r.$$.dirty&132&&t(5,n=s==null?void 0:s.filter(u=>u.floorIndex===i))},[a,o,i,c,p,n,l,s]}class Fe extends W{constructor(e){super();M(this,e,Ce,Se,H,{five:0,pxmm:1,floorIndex:2,hoverEnable:3,floorplanData:4,extraObjects:7})}}function Re(r){L(r,"svelte-7d8ub2",".plugin-floorplan-radar.svelte-7d8ub2{width:100%;height:100%;display:flex;justify-content:center;align-items:center}.plugin-floorplan-radar-container.svelte-7d8ub2{position:relative}")}function Y(r){let e,t,n,a,o=`${r[7]}px`,i=`${r[10]}px`,c;const p=[{five:r[0],pxmm:r[8],floorIndex:r[9],floorplanData:r[2],hoverEnable:r[1],extraObjects:r[4]}];let s={};for(let f=0;f<p.length;f+=1)s=U(s,p[f]);t=new Fe({props:s});const l=[{pxmm:r[8],five:r[0],floorplanData:r[2],cameraImageUrl:r[3]}];let u={};for(let f=0;f<l.length;f+=1)u=U(u,l[f]);return a=new Pe({props:u}),{c(){e=w("div"),D(t.$$.fragment),n=R(),D(a.$$.fragment),x(e,"class","plugin-floorplan-radar-container svelte-7d8ub2"),d(e,"width",o,!1),d(e,"height",i,!1)},m(f,m){j(f,e,m),E(t,e,null),y(e,n),E(a,e,null),c=!0},p(f,m){const b=m&791?z(p,[{five:f[0],pxmm:f[8],floorIndex:f[9],floorplanData:f[2],hoverEnable:f[1],extraObjects:f[4]}]):{};t.$set(b);const _=m&269?z(l,[{pxmm:f[8],five:f[0],floorplanData:f[2],cameraImageUrl:f[3]}]):{};a.$set(_),m&128&&o!==(o=`${f[7]}px`)&&d(e,"width",o,!1),m&1024&&i!==(i=`${f[10]}px`)&&d(e,"height",i,!1)},i(f){c||(h(t.$$.fragment,f),h(a.$$.fragment,f),c=!0)},o(f){v(t.$$.fragment,f),v(a.$$.fragment,f),c=!1},d(f){f&&O(e),k(t),k(a)}}}function Ue(r){let e,t,n,a=r[5]!==0&&Y(r);return{c(){e=w("div"),a&&a.c(),x(e,"class","plugin-floorplan-radar svelte-7d8ub2"),le(()=>r[11].call(e))},m(o,i){j(o,e,i),a&&a.m(e,null),t=se(e,r[11].bind(e)),n=!0},p(o,[i]){o[5]!==0?a?(a.p(o,i),i&32&&h(a,1)):(a=Y(o),a.c(),h(a,1),a.m(e,null)):a&&(te(),v(a,1,1,()=>{a=null}),ne())},i(o){n||(h(a),n=!0)},o(o){v(a),n=!1},d(o){o&&O(e),a&&a.d(),t()}}}function ze(r,e,t){let{five:n}=e,{hoverEnable:a}=e,{floorplanData:o}=e,{cameraImageUrl:i}=e,{extraObjects:c=[]}=e,p=0,s=0,l=0,u=0,f=0,m=0;function b(g){t(9,s=n.work.observers[g].floorIndex)}ee(()=>(n.on("panoArrived",b),()=>{n.off("panoArrived",b)}));function _(){l=this.clientWidth,u=this.clientHeight,t(5,l),t(6,u)}return r.$$set=g=>{"five"in g&&t(0,n=g.five),"hoverEnable"in g&&t(1,a=g.hoverEnable),"floorplanData"in g&&t(2,o=g.floorplanData),"cameraImageUrl"in g&&t(3,i=g.cameraImageUrl),"extraObjects"in g&&t(4,c=g.extraObjects)},r.$$.update=()=>{if(r.$$.dirty&228){const g=Math.min(l,u),{max:S,min:C}=o.bounding,P=S.x-C.x,T=S.y-C.y,J=function(){return P>T?[g,g/P*T]:[g/T*P,g]}();t(7,f=J[0]),t(10,m=J[1]),t(8,p=f/P)}},[n,a,o,i,c,l,u,f,p,s,m,_]}class Ae extends W{constructor(e){super();M(this,e,ze,Ue,H,{five:0,hoverEnable:1,floorplanData:2,cameraImageUrl:3,extraObjects:4},Re)}}class We{constructor(e,t){Object.defineProperty(this,"app",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"five",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wrapperSelector",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wrapper",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"extraObjects",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"originExtraObjects",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"dispose",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var n;(n=this.app)===null||n===void 0||n.$destroy()}}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:async n=>{const a=JSON.parse(JSON.stringify(n)),o=await _e(a);this.data=o,this.render()}}),this.five=e,(t==null?void 0:t.configs)&&Object.assign(this.configs,t.configs),typeof(t==null?void 0:t.wrapper)=="string"?this.wrapperSelector=t.wrapper:(t==null?void 0:t.wrapper)instanceof Element&&(this.wrapper=t.wrapper),e.once("dispose",this.dispose)}appendTo(e){this.wrapper=e,this.render()}changeConfigs(e){Object.assign(this.configs,e),this.render()}setExtraObjectsWith3DPositions(e){this.originExtraObjects=e,!!this.data&&(this.extraObjects=B(e,this.five,this.data),this.render())}render(){var e;if(!this.wrapper){const n=document.querySelector(this.wrapperSelector);this.wrapper=n}if(!this.data||!this.wrapper)return;!this.extraObjects&&this.originExtraObjects&&(this.extraObjects=B(this.originExtraObjects,this.five,this.data));const t={five:this.five,floorplanData:this.data,extraObjects:this.extraObjects,cameraImageUrl:this.configs.cameraImageUrl,hoverEnable:(e=this.configs.hoverEnable)!==null&&e!==void 0?e:!1};if(!this.app){this.app=new Ae({target:this.wrapper,props:t});return}this.app.$set(t)}}const Me=(r,e)=>new We(r,e);function Q(){return{width:window.innerWidth,height:window.innerHeight}}function He(){const[r,e]=I.exports.useState(Q);return I.exports.useEffect(()=>{const t=()=>e(Q());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),r}const Te=()=>{const[r,e]=fe(),t=Z($.FLOOR_PLAN_SERVER_PLUGIN_DATA),n=ue(),a=I.exports.useRef(null),[o,i]=I.exports.useState(!1);return I.exports.useEffect(()=>{!a.current||r.mode!==N.Mode.Panorama||n.plugins.panoFloorplanRadarPlugin.appendTo(a.current)},[]),I.exports.useEffect(()=>{!t||JSON.stringify(t)==="{}"||n.plugins.panoFloorplanRadarPlugin.load(t)},[t]),I.exports.useEffect(()=>{r.mode===N.Mode.Panorama?i(!0):i(!1)},[r.mode]),A(ce,{onClick:()=>e({mode:N.Mode.Floorplan}),sx:{display:`${o?"flex":"none"}`,justifyContent:"center",alignItems:"center",position:"absolute",top:"60px",right:"20px",padding:"10px",width:"90px",height:"120px",backgroundColor:"rgba(0, 0, 0, .2)"},ref:a})},Ne={},X=xe(),Le=JSON.stringify(X)!=="{}"?X:Ne,Je=pe({imageOptions:{size:512},textureOptions:{size:512},plugins:[[Me,"panoFloorplanRadarPlugin",{...Le}]]}),qe=()=>{const r=He(),e=Z($.WORK);return e&&me(Je,{initialWork:de(e),ref:t=>Object.assign(window,{$five:t?.five}),children:[A(ge,{...r}),A(Te,{})]})};he.render(A(qe,{}),document.querySelector("#app"));
