import{u as M,D as y}from"./useFetchDatas-b277a088.js";import{al as D,am as L,an as O,ao as E,ap as N,r as v,u as U,a as k,b as I,a9 as W,F as m,j as i,aa as T,d as w,ab as X,ac as g,ad as Y,ae as $,c as H,p as q,e as G,$ as J}from"./vendor-b2bf1e8d.js";import"./typings-ddaad332.js";import{t as K}from"./transfromToMeshBasicMaterial-5433e41f.js";const p=(e,n,o)=>{const s=new D,t=new L(e,n,o,"YXZ");return s.makeRotationFromEuler(t),s},V=(e,{scale:n,rotation:o,position:s})=>{if(n&&e.scale.set(n,n,n),o){const[t,r,d]=o;t&&e.applyMatrix4(p(t,0,0)),r&&e.applyMatrix4(p(0,r,0)),d&&e.applyMatrix4(p(0,0,d))}return s&&e.position.set(s.x,s.y,s.z),e},Z=(e,n)=>{const o=n.fbx_url||"//vrlab-static.ljcdn.com/release/web/v3/dipan3/dipan.FBX",s=n.north_rad||void 0,t={},r=async a=>{const c=(a==null?void 0:a.fbx_url)||o,l=(a==null?void 0:a.north_rad)||s;if(!l)throw new Error('"northRad"\u914D\u7F6E\u53C2\u6570\u7F3A\u5931\uFF1A\u672A\u914D\u7F6E\u6307\u5357\u9488\u6307\u5411\uFF01');const u=e.model.bounding,_=u.max.x-u.min.x,F=u.max.z-u.min.z,P=Math.max(_,F),f=await new O().loadAsync(c);K(f,{transparent:!0,side:E,blending:N});const z=[0,l-Math.PI/2,0],{model:{bounding:{max:{x:C,z:R},min:{x:j,y:b,z:S}}}}=e;t.yBase=b;const A={x:(C+j)/2,y:b-1.6,z:(R+S)/2},B=.0045*P;return V(f,{position:A,rotation:z,scale:B}),t.object=f,!0},d=({latitude:a})=>{if(!t.object)return;const c=x(a);c&&(t.object.position.y=c)},x=a=>{if(t.yBase===void 0)return;const c=.6;if(a>=Math.PI/4)return t.yBase-(c+1.6);const l=a*(4/Math.PI);return t.yBase-(c*l+1.6)};return{load:r,disable:()=>{!t.object||(e.scene.remove(t.object),e.needsRender=!0,e.off("cameraDirectionUpdate",d))},enable:()=>{if(!t.object)return;const a=x(e.getPose().latitude);a&&(t.object.position.y=a),e.scene.add(t.object),e.needsRender=!0,e.on("cameraDirectionUpdate",d)}}};function h(){return{width:window.innerWidth,height:window.innerHeight}}function Q(){const[e,n]=v.exports.useState(h);return v.exports.useEffect(()=>{const o=()=>n(h());return window.addEventListener("resize",o,!1),()=>window.removeEventListener("resize",o,!1)}),e}const ee=()=>{const[e,n]=U(),o=k(),s=I(),t=M(y.FLOOR_PLAN_SERVER_PLUGIN_DATA);return W("modelLoaded",async()=>{if(!t||JSON.stringify(t)==="{}")return;const r=t?.computed_data?.entrance?.north_rad;await o.plugins.modelChassisCompassPlugin.load({north_rad:r}),n({panoIndex:0,fov:106,latitude:-.07983208586321928,longitude:1.52265306535823,mode:m.Mode.Floorplan}),o.plugins.modelChassisCompassPlugin.enable()},[t]),s!=="Loaded"?null:i(T,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},children:w(X,{showLabels:!0,value:e.mode,onChange:(r,d)=>{n({mode:d})},children:[i(g,{label:"\u5168\u666F\u6F2B\u6E38",icon:i(Y,{}),value:m.Mode.Panorama}),i(g,{label:"\u7A7A\u95F4\u603B\u89C8",icon:i($,{}),value:m.Mode.Floorplan})]})})},te=H({imageOptions:{size:512},textureOptions:{size:512},plugins:[[Z,"modelChassisCompassPlugin",{}]]}),ne=()=>{const e=Q(),n=M(y.WORK);return n&&w(te,{initialWork:q(n),ref:o=>Object.assign(window,{$five:o?.five}),children:[i(G,{...e}),i(ee,{})]})};J.render(i(ne,{}),document.querySelector("#app"));
