import{u as ye,D as Ee}from"./useFetchDatas-b277a088.js";import{aJ as Be,h as Me,i as ke,k as Ae,l as Ie,m as j,n as L,a5 as C,o as E,q as re,a6 as Le,w as ce,U as Ge,v as ie,ag as Je,z as ne,t as I,x as Xe,aK as Ke,y as Qe,aL as $e,aA as et,V as W,aM as ue,al as pe,F as le,a8 as tt,aN as nt,r as K,u as at,a as De,b as ot,j as X,B as it,c as st,d as lt,p as rt,e as ct,f as gt}from"./vendor-b2bf1e8d.js";import{M as dt}from"./index-2b6a6eac.js";import"./typings-ddaad332.js";import{C as ut}from"./index-1bd943cc.js";import{g as pt}from"./getInitialParamFromUrl-141e6748.js";import"./transformPositionToVector3-27356c9f.js";const Oe=Be(null);function ft(t){Ie(t,"svelte-scnx9u",".PanoSpatialTagPlugin__tag-origin.svelte-scnx9u{position:absolute;width:0.5rem;height:0.5rem;border-radius:50%;background:#fff;box-shadow:0 0 .6rem #fff;transform:translate(-50%, -50%) scale(1);transform-origin:center center;animation:svelte-scnx9u-PanoSpatialTagPlugin__tag-origin 1.2s forwards;pointer-events:auto}.PanoSpatialTagPlugin__tag-origin.svelte-scnx9u:after{content:'';position:absolute;top:50%;height:50%;width:2rem;height:2rem;transform:translate(-50%, -50%)}.PanoSpatialTagPlugin__tag-origin-destroy.svelte-scnx9u{transform:translate(-50%, -50%) scale(0.6);animation:svelte-scnx9u-PanoSpatialTagPlugin__tag-origin-destroy 1.2s forwards .7s}@keyframes svelte-scnx9u-PanoSpatialTagPlugin__tag-origin{0%{transform:translate(-50%, -50%) scale(1);opacity:0}100%{transform:translate(-50%, -50%) scale(0.6);opacity:1 }}@keyframes svelte-scnx9u-PanoSpatialTagPlugin__tag-origin-destroy{0%{transform:translate(-50%, -50%) scale(0.6);opacity:1}10%{transform:translate(-50%, -50%) scale(1);opacity:0.9}100%{transform:translate(-50%, -50%) scale(1);opacity:0}}")}function fe(t,e,n){const a=t.slice();return a[3]=e[n],a}function he(t){let e,n=`${t[3].top}%`,a=`${t[3].left}%`,i,r;function s(){return t[2](t[3])}return{c(){e=j("i"),L(e,"class","svelte-scnx9u"),C(e,"PanoSpatialTagPlugin__tag-origin",!0),C(e,"PanoSpatialTagPlugin__tag-origin-destroy",t[3].destroying),E(e,"top",n,!1),E(e,"left",a,!1),E(e,"visibility",t[3].front?"visible":"hidden",!1)},m(p,h){re(p,e,h),i||(r=Le(e,"click",s),i=!0)},p(p,h){t=p,h&1&&C(e,"PanoSpatialTagPlugin__tag-origin-destroy",t[3].destroying),h&1&&n!==(n=`${t[3].top}%`)&&E(e,"top",n,!1),h&1&&a!==(a=`${t[3].left}%`)&&E(e,"left",a,!1),h&1&&E(e,"visibility",t[3].front?"visible":"hidden",!1)},d(p){p&&ce(e),i=!1,r()}}}function ht(t){let e,n=t[0],a=[];for(let i=0;i<n.length;i+=1)a[i]=he(fe(t,n,i));return{c(){for(let i=0;i<a.length;i+=1)a[i].c();e=Ge()},m(i,r){for(let s=0;s<a.length;s+=1)a[s].m(i,r);re(i,e,r)},p(i,[r]){if(r&3){n=i[0];let s;for(s=0;s<n.length;s+=1){const p=fe(i,n,s);a[s]?a[s].p(p,r):(a[s]=he(p),a[s].c(),a[s].m(e.parentNode,e))}for(;s<a.length;s+=1)a[s].d(1);a.length=n.length}},i:ie,o:ie,d(i){Je(a,i),i&&ce(e)}}}function mt(t,e,n){let{origins:a}=e;const i=s=>{Oe.update(()=>`${s}-PanoSpatialTagPlugin-${Date.now()}`)},r=s=>i(s.id);return t.$$set=s=>{"origins"in s&&n(0,a=s.origins)},[a,i,r]}class _t extends Me{constructor(e){super();ke(this,e,mt,ht,Ae,{origins:0},ft)}}function Pt(t){Ie(t,"svelte-1c0xhg0",".PanoSpatialTagPlugin__tag-x.svelte-1c0xhg0.svelte-1c0xhg0{position:relative;display:block;white-space:nowrap;box-sizing:border-box;width:25rem;height:14rem;color:#FFF;transform:translate(0, -100%);transition:height .5s linear}.PanoSpatialTagPlugin__tag-shadow.svelte-1c0xhg0.svelte-1c0xhg0{content:'';position:absolute;width:30rem;height:30rem;top:-15rem;left:-15rem;z-index:-1;opacity:0;transition:opacity .8s .6s;background:url('https://vrlab-image4.ljcdn.com/release/web/PanoSpatialTagPlugin__blur.png');background-size:30rem 30rem}.PanoSpatialTagPlugin__tag-line.svelte-1c0xhg0.svelte-1c0xhg0{position:absolute;left:-1rem;width:2rem;height:100%;overflow:hidden}.PanoSpatialTagPlugin__tag-flagpole.svelte-1c0xhg0.svelte-1c0xhg0{position:absolute;top:0;left:1rem;height:calc(100% - 1.5rem);width:.15rem;background:linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 255, 255, .1));box-shadow:0 .1rem .5rem rgba(0, 0, 0, .2);opacity:0;transform:translate(-50%, 60%) scaleY(0);transition:transform .4s cubic-bezier(.44,.44,.74,.98) , opacity .4s cubic-bezier(.44,.44,.74,.98), width .5s linear, height .5s linear ;transform-origin:center bottom}.PanoSpatialTagPlugin__tag-line1.svelte-1c0xhg0.svelte-1c0xhg0{position:absolute;top:0;left:0.3rem;height:1.8rem;width:.1rem;background:#fff;opacity:0;transform:translate(-50%, 200%) scaleY(0);transform-origin:center top}.PanoSpatialTagPlugin__tag-line2.svelte-1c0xhg0.svelte-1c0xhg0{position:absolute;top:0;left:0.5rem;height:1.8rem;width:.1rem;background:#fff;opacity:0;transform:translate(-50%, 200%) scaleY(0);transform-origin:center top}.PanoSpatialTagPlugin__tag-show.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-line1.svelte-1c0xhg0{animation:svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line1 linear .5s forwards .45s}.PanoSpatialTagPlugin__tag-show.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-line2.svelte-1c0xhg0{animation:svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line2 linear .5s forwards .65s}.PanoSpatialTagPlugin__tag-x.PanoSpatialTagPlugin__tag-upside-down.svelte-1c0xhg0.svelte-1c0xhg0{transform:translate(0, 0)}.PanoSpatialTagPlugin__tag-upside-down.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-line.svelte-1c0xhg0{transform:scaleY(-1)}.PanoSpatialTagPlugin__tag-animate.svelte-1c0xhg0.svelte-1c0xhg0{position:relative;height:100%;overflow:hidden;transform-origin:left top;transition:transform .5s linear}.PanoSpatialTagPlugin__tag-upside-down.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-animate.svelte-1c0xhg0{transform-origin:left bottom}.PanoSpatialTagPlugin__tag-content.svelte-1c0xhg0.svelte-1c0xhg0{position:absolute;display:inline-block;transform:translate(-100%, 0);transition:transform .9s cubic-bezier(0,.65,.16,1.08) .6s;padding-left:.5rem;font-size:1rem}.PanoSpatialTagPlugin__tag-upside-down.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-content.svelte-1c0xhg0{bottom:0}.PanoSpatialTagPlugin__tag-show.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-flagpole.svelte-1c0xhg0{opacity:1;transform:translate(-50%, 0) scaleY(1)}.PanoSpatialTagPlugin__tag-upside-down.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-shadow.svelte-1c0xhg0{top:unset;bottom:-15rem}.PanoSpatialTagPlugin__tag-show.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-shadow.svelte-1c0xhg0{opacity:.32}.PanoSpatialTagPlugin__tag-show.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-content.svelte-1c0xhg0{transform:translate(0, 0)}.PanoSpatialTagPlugin__tag-hide.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-flagpole.svelte-1c0xhg0{opacity:0;transform:translate(-50%, 60%) scaleY(0);transition:transform .5s .55s, opacity .4s .55s}.PanoSpatialTagPlugin__tag-hide.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-shadow.svelte-1c0xhg0{opacity:0;transition:opacity .8s}.PanoSpatialTagPlugin__tag-hide.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-content.svelte-1c0xhg0{transform:translate(-100%, 0);transition:transform .6s cubic-bezier(.53,.06,.88,.59)}.PanoSpatialTagPlugin__tag-hide.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-content .svelte-1c0xhg0{pointer-events:none}.PanoSpatialTagPlugin__tag-hide.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-line1.svelte-1c0xhg0{opacity:0.5;transform:translate(-50%, 10%) scaleY(0);animation:svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line1-hide linear .28s forwards .3s}.PanoSpatialTagPlugin__tag-hide.svelte-1c0xhg0 .PanoSpatialTagPlugin__tag-line2.svelte-1c0xhg0{opacity:0.5;transform:translate(-50%, 0) scaleY(0);animation:svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line2-hide linear .28s forwards .45s}@keyframes svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line1{0%{opacity:0;transform:translate(-50%, 250%) scaleY(1)}50%{opacity:0.5;transform:translate(-50%, 135%) scaleY(1)}100%{opacity:0.5;transform:translate(-50%, 20%) scaleY(0)}}@keyframes svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line2{0%{opacity:0;transform:translate(-50%, 250%) scaleY(1)}50%{opacity:0.5;transform:translate(-50%, 125%) scaleY(1)}100%{opacity:0.5;transform:translate(-50%, 0) scaleY(0)}}@keyframes svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line1-hide{0%{opacity:0.5;transform:translate(-50%, 10%) scaleY(0)}50%{opacity:0.2;transform:translate(-50%, 105%) scaleY(1)}100%{opacity:0;transform:translate(-50%, 200%) scaleY(0)}}@keyframes svelte-1c0xhg0-PanoSpatialTagPlugin__tag-line2-hide{0%{opacity:0.5;transform:translate(-50%, 0) scaleY(0)}50%{opacity:0.2;transform:translate(-50%, 100%) scaleY(1)}100%{opacity:0;transform:translate(-50%, 200%) scaleY(0)}}")}function vt(t){let e,n,a,i,r,s,p,h,D,x,T,w,M,R,A;return{c(){e=j("div"),n=j("div"),a=ne(),i=j("div"),r=j("i"),s=ne(),p=j("i"),h=ne(),D=j("i"),x=ne(),T=j("div"),w=j("div"),L(n,"class","PanoSpatialTagPlugin__tag-shadow svelte-1c0xhg0"),E(n,"transform","translate("+t[7]/2*t[3]*3+"px, "+t[8]/2*(t[1]?-1:1)*t[3]*3+"px)"),L(r,"class","PanoSpatialTagPlugin__tag-flagpole svelte-1c0xhg0"),E(r,"width",t[4]+"rem"),L(p,"class","PanoSpatialTagPlugin__tag-line1 svelte-1c0xhg0"),L(D,"class","PanoSpatialTagPlugin__tag-line2 svelte-1c0xhg0"),L(i,"class","PanoSpatialTagPlugin__tag-line svelte-1c0xhg0"),L(w,"class","PanoSpatialTagPlugin__tag-content svelte-1c0xhg0"),L(T,"class","PanoSpatialTagPlugin__tag-animate svelte-1c0xhg0"),E(T,"transform","scale("+t[3]*3+")"),L(e,"id",M="PanoSpatialTagPlugin__"+t[0]),E(e,"height",20*t[5]+"rem"),L(e,"class","svelte-1c0xhg0"),C(e,"PanoSpatialTagPlugin__tag-x",!0),C(e,"PanoSpatialTagPlugin__tag-upside-down",t[1]),C(e,"PanoSpatialTagPlugin__tag-show",t[10]),C(e,"PanoSpatialTagPlugin__tag-hide",t[10]===!1||t[6])},m(d,_){re(d,e,_),I(e,n),I(e,a),I(e,i),I(i,r),I(i,s),I(i,p),I(i,h),I(i,D),I(e,x),I(e,T),I(T,w),w.innerHTML=t[2],t[16](w),R||(A=Le(w,"click",t[11]),R=!0)},p(d,[_]){_&394&&E(n,"transform","translate("+d[7]/2*d[3]*3+"px, "+d[8]/2*(d[1]?-1:1)*d[3]*3+"px)"),_&16&&E(r,"width",d[4]+"rem"),_&4&&(w.innerHTML=d[2]),_&8&&E(T,"transform","scale("+d[3]*3+")"),_&1&&M!==(M="PanoSpatialTagPlugin__"+d[0])&&L(e,"id",M),_&32&&E(e,"height",20*d[5]+"rem"),_&2&&C(e,"PanoSpatialTagPlugin__tag-upside-down",d[1]),_&1024&&C(e,"PanoSpatialTagPlugin__tag-show",d[10]),_&1088&&C(e,"PanoSpatialTagPlugin__tag-hide",d[10]===!1||d[6])},i:ie,o:ie,d(d){d&&ce(e),t[16](null),R=!1,A()}}}function bt(t,e,n){let{id:a}=e,{upsideDown:i}=e,{content:r}=e,{contentZoom:s}=e,{lineWidthZoom:p}=e,{lineHeightZoom:h}=e,{destroying:D=!1}=e,{folded:x}=e,{dispose:T}=e,{events:w}=e,{hooks:M}=e,R=0,A=0,d,_,o=setTimeout(()=>{x||n(10,_=!0),o=void 0},100);const U=g=>{const Z=Object.keys(w);let k=g.target;for(;k;){const F=k.getAttribute("class");if(!F){k=k.parentNode;continue}if(F.includes("PanoSpatialTagPlugin__tag-content")){k=null;break}Z.forEach(Q=>{F.includes(Q)&&w[Q](a)}),k=k.parentNode}};Xe(()=>{M.emit("initTag",{id:a})});const V=Oe.subscribe(g=>{if(g===null)return;const[Z,k]=g.split("-PanoSpatialTagPlugin-");a===Z&&(M.emit("clickOrigin",{id:a,show:_}),o||(n(10,_=x),n(12,x=!x),o=setTimeout(()=>{o=void 0},1500)))});Ke(()=>{n(7,R=d.offsetWidth),n(8,A=d.offsetHeight),!o&&n(10,_=!x)}),Qe(()=>{M.emit("destroyTag",{id:a}),V(),T()});function q(g){$e[g?"unshift":"push"](()=>{d=g,n(9,d)})}return t.$$set=g=>{"id"in g&&n(0,a=g.id),"upsideDown"in g&&n(1,i=g.upsideDown),"content"in g&&n(2,r=g.content),"contentZoom"in g&&n(3,s=g.contentZoom),"lineWidthZoom"in g&&n(4,p=g.lineWidthZoom),"lineHeightZoom"in g&&n(5,h=g.lineHeightZoom),"destroying"in g&&n(6,D=g.destroying),"folded"in g&&n(12,x=g.folded),"dispose"in g&&n(13,T=g.dispose),"events"in g&&n(14,w=g.events),"hooks"in g&&n(15,M=g.hooks)},[a,i,r,s,p,h,D,R,A,d,_,U,x,T,w,M,q]}class Tt extends Me{constructor(e){super();ke(this,e,bt,vt,Ae,{id:0,upsideDown:1,content:2,contentZoom:3,lineWidthZoom:4,lineHeightZoom:5,destroying:6,folded:12,dispose:13,events:14,hooks:15},Pt)}}const wt={position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",pointerEvents:"none"},me="<",_e=">",Pe="%",ve="locals",St="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",xt={"&":"&amp","<":"&lt",">":"&gt",'"':"&#34","'":"&#39"},S={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};function be(t){return t.replace(/;(\s*$)/,"$1")}function yt(t,e){return new Et(t).compileFunction()(e)}class Et{constructor(e){Object.defineProperty(this,"templateText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"truncate",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"currentLine",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"source",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"regex",{enumerable:!0,configurable:!0,writable:!0,value:new RegExp(St)}),this.templateText=e}compileFunction(){let e;const n=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
  with (`+ve+` || {}) {
`,a=`  }
  return __output;
`,i=function(r){return r==null?"":String(r).replace(/[&<>'"]/g,function(s){return xt[s]||s})};return this._generateSource(),this.source=n+this.source+a,e=this.source,e="escapeFn = escapeFn || "+i.toString()+`;
`+e,new Function(ve+", escapeFn",e)}_generateSource(){this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");const e=this._parseTemplateText(),n=Pe,a=me,i=_e;e&&e.length&&e.forEach((r,s)=>{let p;if(r.indexOf(a+n)===0&&r.indexOf(a+n+n)!==0&&(p=e[s+2],!(p==n+i||p=="-"+n+i||p=="_"+n+i)))throw new Error('Could not find matching close tag for "'+r+'".');this._scanLine(r)})}_parseTemplateText(){let e=this.templateText;const n=this.regex;let a=n.exec(e);const i=[];let r;for(;a;)r=a.index,r!==0&&(i.push(e.substring(0,r)),e=e.slice(r)),i.push(a[0]),e=e.slice(a[0].length),a=n.exec(e);return e&&i.push(e),i}_addOutput(e){if(this.truncate&&(e=e.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!e)return e;e=e.replace(/\\/g,"\\\\"),e=e.replace(/\n/g,"\\n"),e=e.replace(/\r/g,"\\r"),e=e.replace(/"/g,'\\"'),this.source+='    ; __append("'+e+`")
`}_scanLine(e){const n=Pe,a=me,i=_e;switch(e.split(`
`).length-1,e){case a+n:case a+n+"_":this.mode=S.EVAL;break;case a+n+"=":this.mode=S.ESCAPED;break;case a+n+"-":this.mode=S.RAW;break;case a+n+"#":this.mode=S.COMMENT;break;case a+n+n:this.mode=S.LITERAL,this.source+='    ; __append("'+e.replace(a+n+n,a+n)+`")
`;break;case n+n+i:this.mode=S.LITERAL,this.source+='    ; __append("'+e.replace(n+n+i,n+i)+`")
`;break;case n+i:case"-"+n+i:case"_"+n+i:this.mode==S.LITERAL&&this._addOutput(e),this.mode=null,this.truncate=e.indexOf("-")===0||e.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case S.EVAL:case S.ESCAPED:case S.RAW:e.lastIndexOf("//")>e.lastIndexOf(`
`)&&(e+=`
`)}switch(this.mode){case S.EVAL:this.source+="    ; "+e+`
`;break;case S.ESCAPED:this.source+="    ; __append(escapeFn("+be(e)+`))
`;break;case S.RAW:this.source+="    ; __append("+be(e)+`)
`;break;case S.COMMENT:break;case S.LITERAL:this._addOutput(e);break}}else this._addOutput(e)}}}const se=.001,ae=1.4,Te=.01,Mt="https://vrlab-image4.ljcdn.com/release/web/PanoSpatialTagPlugin__blur.png",oe=1.2,Y=3.5,kt=(t,e)=>{var n,a,i,r,s,p;let h=e==null?void 0:e.container;const D=(n=e==null?void 0:e.wait)!==null&&n!==void 0?n:200,x=(a=e==null?void 0:e.maxNumberOnScreen)!==null&&a!==void 0?a:3,T=(i=e==null?void 0:e.minRad)!==null&&i!==void 0?i:Math.PI/4,w=(r=e==null?void 0:e.nearTolerance)!==null&&r!==void 0?r:100,M=(s=e==null?void 0:e.upsideHeight)!==null&&s!==void 0?s:1.6,R=ut(t),A=document.createElement("div");A.classList.add("PanoSpatialTagPlugin"),Object.assign(A.style,wt);const d=new et;let _=new Image;_.src=Mt;const o={points:[],origins:[],tags:[],template:"",events:{},render:yt,folded:!1,enabled:!0,forbidden:!0},U=new _t({target:A,props:{origins:o.origins}}),V=(l,f)=>{k(),f&&F()},q=()=>{o.forbidden&&(o.forbidden=!1,F())},g=(l,f)=>{if(o.tags.length===0)return;const b=f.longitude-t.state.longitude,c=t.camera.clone();c.position.copy(f.offset),c.rotateOnWorldAxis(new W(0,1,0),b),c.updateProjectionMatrix(),c.updateMatrixWorld(!0);const N=new ue,B=new pe;B.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),N.setFromProjectionMatrix(B),o.tags.forEach(u=>{const $=c.position.clone().setY(ae).distanceTo(u.position);if($<oe||$>Y||!N.containsPoint(u.position))return u.destroying=!0;const G=u.position.clone().sub(c.position).setY(0);if(G.angleTo(u.normal)>Math.PI/2-T&&G.angleTo(u.normal)<Math.PI/2+T)return u.destroying=!0}),o.tags.forEach(u=>{u.destroying?u.app.$set({contentZoom:.1+c.position.distanceTo(u.position)/Y,lineWidthZoom:.38*(.01+c.position.distanceTo(u.position)/Y),destroying:u.destroying}):u.app.$set({lineWidthZoom:.38*(.01+c.position.distanceTo(u.position)/Y),lineHeightZoom:.4+(c.position.distanceTo(u.position)-oe)/Y*.6,contentZoom:.1+c.position.distanceTo(u.position)/Y})}),setTimeout(()=>{o.tags.forEach(u=>{u.destroying&&(u.app.$destroy(),u=null)}),o.tags=o.tags.filter(u=>!u.destroying),k()},1900)},Z=l=>{l!==le.Mode.Panorama&&!o.forbidden&&(U.$set({origins:[]}),o.tags.forEach(f=>{f.app.$destroy(),f=null}),o.origins=[],o.tags=[],o.forbidden=!0)},k=()=>{if(o.forbidden||!o.enabled)return;const l=t.camera,f=l.getWorldDirection(new W);o.origins=o.tags.map(b=>{const c=b.position.clone().project(l),N=b.position.clone().sub(l.position).setY(0).angleTo(f.setY(0))<Math.PI/2;return{id:b.id,front:N,left:(c.x+1)/2*100,top:(-c.y+1)/2*100,destroying:b.destroying}}),U.$set({origins:o.origins})},F=()=>{o.forbidden||!o.enabled||(o.timeoutId&&clearTimeout(o.timeoutId),o.timeoutId=setTimeout(()=>{o.timeoutId=void 0;const l=Q();l.length&&(o.tags=o.tags.concat(l),k())},D))},Q=()=>{const{clientWidth:l,clientHeight:f}=t.getElement(),b=[],c=t.camera,N=new ue,B=new pe,u=c.getWorldDirection(new W);B.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),N.setFromProjectionMatrix(B);const $=o.tags.filter(P=>N.containsPoint(P.position)&&!P.destroying).length,G=o.points.reduce((P,y)=>{if(o.tags.find(v=>y.id===v.id&&!v.destroying))return P;const O=c.position.clone().setY(ae).distanceTo(y.position);if(O<oe||O>Y||!N.containsPoint(y.position))return P;const J=y.position.clone().sub(c.position).setY(0);if(J.angleTo(y.normal)>Math.PI/2-T&&J.angleTo(y.normal)<Math.PI/2+T)return P;const ee=y.position.clone().project(c);if(!o.tags.every(v=>{if(v.position.clone().sub(c.position).setY(0).angleTo(u.setY(0))>Math.PI/2)return!0;const H=v.position.clone().project(c);return Math.sqrt(Math.pow((ee.x-H.x)/2*l,2)+Math.pow((ee.y-H.y)/2*f,2))>w}))return P;const z={id:y.id,position:y.position,normal:y.normal,replacement:y.replacement,weight:y.weight,distance:O};let m;for(let v=0,H=P.length;v<H;v++){const te=P[v];if(z.weight>te.weight){m=v;break}if(z.distance<te.distance){m=v;break}}return m!==void 0?P.splice(m,0,z):P.push(z),P},[]);for(let P=0,y=G.length;P<y&&!($+b.length>=x);P++){const O=G[P];if(b.find(m=>O.id===m.id))continue;const J=O.position.clone().project(c);if(!o.tags.concat(b).every(m=>{if(m.position.clone().sub(c.position).setY(0).angleTo(u.setY(0))>Math.PI/2)return!0;const v=m.position.clone().project(c);return Math.sqrt(Math.pow((J.x-v.x)/2*l,2)+Math.pow((J.y-v.y)/2*f,2))>w}))continue;const ee=new tt(c.position.clone().setY(ae),O.position.clone().sub(c.position.clone().setY(ae)).normalize(),0,O.distance+Te),[z]=t.model.intersectRaycaster(ee);if(!!z&&O.distance-z.distance<Te){const{position:m,normal:v,id:H,replacement:te}=O,Ze=new nt().setFromNormalAndCoplanarPoint(v,m),de=m.clone().sub(c.position).cross(new W(0,1,0)).setLength(se),ze=[m.clone(),m.clone().add(de),m.clone().add(new W(0,se,0)).add(de),m.clone().add(new W(0,se,0))].map(qe=>Ze.projectPoint(qe,new W)),{container:He,dispose:Ue}=R.create3DDomContainer(ze)||{},Ve=new Tt({target:He,props:{id:H,content:o.render(o.template,te),lineWidthZoom:.38*(.01+c.position.distanceTo(m)/Y),lineHeightZoom:.4+(c.position.distanceTo(m)-oe)/Y*.6,contentZoom:.1+c.position.distanceTo(m)/Y,upsideDown:m.y>M,folded:o.folded,events:o.events,hooks:d,dispose:Ue}});b.push({position:m,normal:v,id:H,app:Ve})}}return b},Ye=l=>{o.points=l.points.map(f=>{var b,c;return{id:f.id,position:new W().fromArray(f.position),normal:new W().fromArray(f.normal),replacement:(b=f.replacement)!==null&&b!==void 0?b:{},weight:(c=f.weight)!==null&&c!==void 0?c:-1}}),l.render&&(o.render=l.render),l.template&&(o.template=l.template),l.events&&(o.events=l.events),l.enabled===!1&&(o.enabled=l.enabled),l.folded===!0&&(o.folded=l.folded)},Ce=()=>{o.enabled=!0,F()},Re=()=>{o.enabled=!1,U.$set({origins:[]}),o.tags.forEach(l=>{l.app.$destroy(),l=null}),o.origins=[],o.tags=[]},Fe=()=>{o.folded=!1,o.tags.forEach(l=>{l.app.$set({folded:o.folded})})},We=()=>{o.folded=!0,o.tags.forEach(l=>{l.app.$set({folded:o.folded})})},je=l=>{o.tags.forEach(f=>{f.id===l&&f.app.$set({folded:!1})})},Ne=l=>{o.tags.forEach(f=>{f.id===l&&f.app.$set({folded:!0})})},ge=()=>{_=null,R.disposeAll(),U.$destroy(),o.tags.forEach(l=>{l.app.$destroy(),l=null}),o.origins=[],o.tags=[],t.off("panoWillArrive",g),t.off("panoArrived",q),t.off("modeChange",Z),t.off("cameraUpdate",V)};return((p=t==null?void 0:t.model)===null||p===void 0?void 0:p.loaded)?(h||(h=t.getElement().parentElement),h.appendChild(A),o.forbidden=!1,F(),t.on("panoWillArrive",g),t.on("panoArrived",q),t.on("modeChange",Z),t.on("cameraUpdate",V)):t.once("modelBvhLoaded",()=>{h||(h=t.getElement().parentElement),h.appendChild(A),o.forbidden=!1,F(),t.on("panoWillArrive",g),t.on("panoArrived",q),t.on("modeChange",Z),t.on("cameraUpdate",V)}),t.on("dispose",ge),{load:Ye,unfoldAll:Fe,foldAll:We,unfold:je,fold:Ne,enable:Ce,disable:Re,hooks:d,dispose:ge}};function we(){return{width:window.innerWidth,height:window.innerHeight}}function At(){const[t,e]=K.exports.useState(we);return K.exports.useEffect(()=>{const n=()=>e(we());return window.addEventListener("resize",n,!1),()=>window.removeEventListener("resize",n,!1)}),t}const It=()=>{const[t,e]=at(),n=De(),a=K.exports.useRef(null),i=ot();return K.exports.useEffect(()=>{!a.current||t.mode!==le.Mode.Panorama||n.plugins.modelViewPlugin.appendTo(a.current,{width:90,height:120})},[t.mode,i]),t.mode!==le.Mode.Panorama||i!=="Loaded"?null:X(it,{onClick:()=>e({mode:"Floorplan"}),sx:{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:"60px",right:"20px",padding:"10px",width:"110px",height:"140px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, .2)"},ref:a})},Lt=()=>{const t=De(),e=ye(Ee.MODEL_TAG,"81gmMq5eXl5I9y7JMk");return K.exports.useEffect(()=>{if(!e)return;const n=e.map(a=>{const{id:i,position:r,normal:s,weight:p,name:h,price:D,brand:x}=a;return{id:i,position:r,normal:s,weight:p,replacement:{name:h,price:D,brand:x}}});t.plugins.panoSpatialTagPlugin.load({points:n,template:`
            <div class="tag-wrapper" style="pointer-events: auto;">
              <%if (brand) {%><div style="background:url('//vrlab-static.ljcdn.com/release/web/brand_bg.15e354d0.png') no-repeat;background-size:100% 100%;box-shadow: 0 -0.625rem 0.625rem 0 rgba(0, 0, 0, 0.1);
                border-radius: 0.0625rem;overflow: hidden;font-size: 0.6875rem;padding:0.125rem;width:max-content;margin-bottom:0.375rem;line-height:1;">
                <%= brand %>
              </div><% } %>
              <div style="max-width:7rem;overflow:hidden;white-space: nowrap;text-overflow: ellipsis;line-height:1;margin-bottom:0.375rem;"><%= name %></div>
              <%if (price) {%><div style="display:flex;align-items:center;font-family: Helvetica;font-size: 0.9375rem;font-weight:600;line-height:1;color: #ffdda1;text-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.1);">
                <svg height="12" viewBox="0 0 10 12" width="10" xmlns="http://www.w3.org/2000/svg">
                  <path d="m6.30970149 6.49402985h1.82910448v1.2761194h-2.12686567v3.50223885h-2.45298508v-3.50223885h-2.12686567v-1.2761194h1.82910448l-3.26119403-6.49402985h2.60895522l2.16940299 5.3738806 2.2119403-5.3738806h2.50970149z" fill="#ffdda1" transform="translate(.182 .682)"/>
                </svg>
                <span><%= price %></span>
              </div>
              <% } %>
            </div>`,events:{"tag-wrapper":a=>{t.plugins.panoSpatialTagPlugin.fold(a)}}})},[e]),null},Dt={},Se=pt(),xe=JSON.stringify(Se)!=="{}"?Se:Dt,Ot=st({plugins:[[kt,"panoSpatialTagPlugin",{...xe}],[dt,"modelViewPlugin",{...xe}]]}),Yt=()=>{const t=At(),e=ye(Ee.WORK,"81gmMq5eXl5I9y7JMk");return e&&lt(Ot,{initialWork:rt(e),ref:n=>Object.assign(window,{$five:n?.five}),children:[X(ct,{...t}),X(Lt,{}),X(It,{})]})};gt.exports.render(X(Yt,{}),document.querySelector("#app"));
