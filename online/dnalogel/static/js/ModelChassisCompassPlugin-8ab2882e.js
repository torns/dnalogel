import{u as M,D as y}from"./useFetchDatas-9069443e.js";import{ak as D,al as L,am as O,an as E,ao as k,r as g,u as N,a as U,b as I,aa as W,F as m,j as i,ab as T,d as w,ac as X,ad as h,ae as Y,af as H,c as $,p as q,e as G,R as J}from"./vendor-1f431ae3.js";import"./constants-62640824.js";import{t as K}from"./transfromToMeshBasicMaterial-0c27a0b0.js";const p=(e,n,a)=>{const o=new D,t=new L(e,n,a,"YXZ");return o.makeRotationFromEuler(t),o},V=(e,{scale:n,rotation:a,position:o})=>{if(n&&e.scale.set(n,n,n),a){const[t,r,d]=a;t&&e.applyMatrix4(p(t,0,0)),r&&e.applyMatrix4(p(0,r,0)),d&&e.applyMatrix4(p(0,0,d))}return o&&e.position.set(o.x,o.y,o.z),e},Z=(e,n)=>{const a=n.fbx_url||"//vrlab-static.ljcdn.com/release/web/v3/dipan3/dipan.FBX",o=n.north_rad||void 0,t={},r=async s=>{const c=s?.fbx_url||a,l=s?.north_rad||o;if(!l)throw new Error('"northRad"\u914D\u7F6E\u53C2\u6570\u7F3A\u5931\uFF1A\u672A\u914D\u7F6E\u6307\u5357\u9488\u6307\u5411\uFF01');const u=e.model.bounding,F=u.max.x-u.min.x,_=u.max.z-u.min.z,P=Math.max(F,_),f=await new O().loadAsync(c);K(f,{transparent:!0,side:E,blending:k});const z=[0,l-Math.PI/2,0],{model:{bounding:{max:{x:R,z:C},min:{x:j,y:b,z:S}}}}=e;t.yBase=b;const A={x:(R+j)/2,y:b-1.6,z:(C+S)/2},B=.0045*P;return V(f,{position:A,rotation:z,scale:B}),t.object=f,!0},d=({latitude:s})=>{if(!t.object)return;const c=x(s);c&&(t.object.position.y=c)},x=s=>{if(t.yBase===void 0)return;const c=.6;if(s>=Math.PI/4)return t.yBase-(c+1.6);const l=s*(4/Math.PI);return t.yBase-(c*l+1.6)};return{load:r,disable:()=>{!t.object||(e.scene.remove(t.object),e.needsRender=!0,e.off("cameraDirectionUpdate",d))},enable:()=>{if(!t.object)return;const s=x(e.getPose().latitude);s&&(t.object.position.y=s),e.scene.add(t.object),e.needsRender=!0,e.on("cameraDirectionUpdate",d)}}};function v(){return{width:window.innerWidth,height:window.innerHeight}}function Q(){const[e,n]=g.exports.useState(v);return g.exports.useEffect(()=>{const a=()=>n(v());return window.addEventListener("resize",a,!1),()=>window.removeEventListener("resize",a,!1)}),e}const ee=()=>{const[e,n]=N(),a=U(),o=I(),t=M(y.FLOOR_PLAN_SERVER_PLUGIN_DATA);return W("modelLoaded",async()=>{if(!t||JSON.stringify(t)==="{}")return;const r=t?.computed_data?.entrance?.north_rad;await a.plugins.modelChassisCompassPlugin.load({north_rad:r}),n({panoIndex:0,fov:106,latitude:-.07983208586321928,longitude:1.52265306535823,mode:m.Mode.Floorplan}),a.plugins.modelChassisCompassPlugin.enable()},[t]),o!=="Loaded"?null:i(T,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},children:w(X,{showLabels:!0,value:e.mode,onChange:(r,d)=>{n({mode:d})},children:[i(h,{label:"\u5168\u666F\u6F2B\u6E38",icon:i(Y,{}),value:m.Mode.Panorama}),i(h,{label:"\u7A7A\u95F4\u603B\u89C8",icon:i(H,{}),value:m.Mode.Floorplan})]})})},te=$({imageOptions:{size:512},textureOptions:{size:512},plugins:[[Z,"modelChassisCompassPlugin",{}]]}),ne=()=>{const e=Q(),n=M(y.WORK);return n&&w(te,{initialWork:q(n),ref:a=>Object.assign(window,{$five:a?.five}),children:[i(G,{...e}),i(ee,{})]})};J.render(i(ne,{}),document.querySelector("#app"));
