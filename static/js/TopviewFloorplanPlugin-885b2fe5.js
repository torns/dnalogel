import{u as g,D as w}from"./useFetchDatas-b277a088.js";import{V as F,r as d,a as y,u as O,b as x,j as o,aa as E,d as P,ab as j,ac as c,ad as S,F as v,ae as C,af as I,c as M,p as D,e as L,B as T,$ as _}from"./vendor-b2bf1e8d.js";import"./typings-ddaad332.js";import{f as A}from"./RoomHighlight-ba554c03.js";import{g as G,o as z,c as p,C as W}from"./changeModelCanvasOpacity-ba3e773b.js";import{g as N}from"./getInitialParamFromUrl-141e6748.js";const R={position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",zIndex:"10"};class k{constructor(t,i){Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:{width:0,height:0}}),Object.defineProperty(this,"visible",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"pxmm",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"app",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"five",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"panoIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"floorIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"configs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"lastPanoramaLongitude",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"selector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"floorplanData",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"wrapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:document.createElement("div")}),Object.defineProperty(this,"dispose",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,n;this.hide(),(e=this.app)===null||e===void 0||e.$destroy(),(n=this.container)===null||n===void 0||n.remove(),this.five.off("modeChange",this.onFiveModeChange),this.five.off("panGesture",this.onFivePanGesture),this.five.off("panoArrived",this.onFivePanoArrived),this.five.off("modelLoaded",this.onFiveModelLoaded),this.five.off("pinchGesture",this.onFivePinchGesture),this.five.off("wantsGesture",this.onFiveWantsGesture),this.five.off("wantsMoveToPano",this.onFiveWantsMoveToPano),this.five.off("initAnimationEnded",this.onFiveInitAnimationEnded),this.five.off("modelShownFloorChange",this.onModelShownFloorChange)}}),Object.defineProperty(this,"onFiveWantsMoveToPano",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.visible&&this.configs.preventRoomClick)return!1}}),Object.defineProperty(this,"onFiveWantsGesture",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!(e!=="pan"&&e!=="pinch"&&e!=="mouseWheel")&&this.visible&&!this.configs.gestureEnable)return!1}}),Object.defineProperty(this,"onModelShownFloorChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(this.floorIndex!==e){if(e===null){const n=this.five.getCurrentState().panoIndex;this.floorIndex=this.five.work.observers[n].floorIndex;return}this.floorIndex=e,this.updateSize(),this.render()}}}),Object.defineProperty(this,"onFivePanoArrived",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var n;!((n=this.five)===null||n===void 0?void 0:n.work)||(this.panoIndex=e,this.floorIndex=this.five.work.observers[e].floorIndex)}}),Object.defineProperty(this,"onFivePanGesture",{enumerable:!0,configurable:!0,writable:!0,value:()=>{!this.visible||this.updatePosition()}}),Object.defineProperty(this,"onFivePinchGesture",{enumerable:!0,configurable:!0,writable:!0,value:()=>{!this.visible||(this.updatePosition(),this.updateSize())}}),Object.defineProperty(this,"onFiveModelLoaded",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.wrapper||!this.selector)return;const e=this.selector instanceof Element?this.selector:document.querySelector(this.selector);if(!e)throw new Error("\u4E0D\u6B63\u786E\u7684\u7236\u5BB9\u5668\u9009\u62E9\u5668");this.wrapper=e,e.append(this.container)}}),Object.defineProperty(this,"onFiveModeChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(e!=="Topview")return this.hide()}}),Object.defineProperty(this,"onFiveInitAnimationEnded",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const{mode:e}=this.five.getCurrentState();e==="Topview"&&this.show()}}),Object.defineProperty(this,"updateSize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.floorplanData||!this.container||!this.wrapper||this.five.getCurrentState().mode!=="Topview")return;const{min:e,max:n}=this.floorplanData.bounding,r=n.x-e.x,s=n.y-e.y,u=this.configs.attachedTo?{attachedTo:this.configs.attachedTo}:void 0,l=G(this.five,this.wrapper,this.floorIndex,u),h=Math.ceil(r*l),f=Math.ceil(s*l);this.pxmm=l,this.size={width:h,height:f},this.container.style.width=h+"px",this.container.style.height=f+"px"}}),this.five=t,this.selector=i.selector,this.configs=z(i,["selector"]),this.five.addExtraElement(this.container),this.container.classList.add("floorplan-plugin"),Object.assign(this.container.style,R),this.five.model.loaded?this.onFiveModelLoaded():t.once("modelLoaded",this.onFiveModelLoaded),this.five.once("dispose",this.dispose),this.five.on("modeChange",this.onFiveModeChange),this.five.on("panGesture",this.onFivePanGesture),this.five.on("mouseWheel",this.onFivePinchGesture),this.five.on("panoArrived",this.onFivePanoArrived),this.five.on("pinchGesture",this.onFivePinchGesture),this.five.on("wantsGesture",this.onFiveWantsGesture),this.five.on("wantsMoveToPano",this.onFiveWantsMoveToPano),this.five.on("initAnimationEnded",this.onFiveInitAnimationEnded),this.five.on("modelShownFloorChange",this.onModelShownFloorChange)}async load(t){const i=JSON.parse(JSON.stringify(t));this.floorplanData=await A(i),this.render()}appendTo(t){return this.wrapper=t,t.appendChild(this.container),this}show(){this.visible=!0,this.five.model.show(this.floorIndex),this.updatePosition(),this.updateSize();const t=500,i=this.configs.modelOpacity;typeof i=="number"&&p(this.five,i,t),this.render(t)}hide(){this.visible=!1,p(this.five,1,0),this.render()}updatePosition(){var t;const i=(t=this.five.model)===null||t===void 0?void 0:t.bounding.getCenter(new F);if(!i)return;const e=i.clone().project(this.five.camera),n=(e.x+1)/2,r=-(e.y-1)/2;this.container.style.left=n*100+"%",this.container.style.top=r*100+"%"}render(t){if(!this.container||!this.floorplanData||this.size.width===0)return;const{northDesc:i,getLabelElement:e,cameraImageUrl:n,hoverEnable:r,compassEnable:s,roomLabelsEnable:u,ruleLabelsEnable:l}=this.configs,h={getLabelElement:e,northDesc:i??"\u5317",cameraImageUrl:n,visible:this.visible,duration:t??0,panoIndex:this.panoIndex,floorIndex:this.floorIndex,floorplanData:this.floorplanData,hoverEnable:r??!1,compassEnable:s??!0,ruleLabelsEnable:l??!0,roomLabelsEnable:u??!0,lastPanoramaLongitude:this.lastPanoramaLongitude};this.app?this.app.$set(h):this.app=new W({target:this.container,intro:!0,props:h})}}const B=(a,t)=>new k(a,t);function b(){return{width:window.innerWidth,height:window.innerHeight}}function U(){const[a,t]=d.exports.useState(b);return d.exports.useEffect(()=>{const i=()=>t(b());return window.addEventListener("resize",i,!1),()=>window.removeEventListener("resize",i,!1)}),a}const $=()=>{const a=y(),[t,i]=O(),e=x(),n=g(w.FLOOR_PLAN_SERVER_PLUGIN_DATA);return d.exports.useEffect(()=>{if(!n||JSON.stringify(n)==="{}")return;a.plugins.topviewFloorplanPlugin.load(n)},[n]),e!=="Loaded"?null:o(E,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},className:"topview-floorplan-plugin-use",children:P(j,{showLabels:!0,value:t.mode,onChange:(r,s)=>{i({mode:s})},children:[o(c,{label:"\u5168\u666F\u6F2B\u6E38",icon:o(S,{}),value:v.Mode.Panorama}),o(c,{label:"\u4FEF\u89C6\u6A21\u578B",icon:o(C,{}),value:v.Mode.Topview})]})})};Object.assign(window,{THREE:I});const J={hoverEnable:!0,northDesc:"N"},m=N(),V=JSON.stringify(m)!=="{}"?m:J,q=M({imageOptions:{size:512},textureOptions:{size:512},plugins:[[B,"topviewFloorplanPlugin",{selector:".plugin-full-screen-container",...V}]]}),H=()=>{const a=U(),t=g(w.WORK);return t&&P(q,{initialWork:D(t),ref:i=>Object.assign(window,{$five:i?.five}),children:[o(L,{...a}),o(T,{className:"plugin-full-screen-container",sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none"}}),o($,{})]})};_.render(o(H,{}),document.querySelector("#app"));
