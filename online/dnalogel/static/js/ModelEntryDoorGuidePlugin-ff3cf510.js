import{u as _,D as C}from"./useFetchDatas-9069443e.js";import{aq as L,am as k,an as B,ap as U,ar as q,r as j,u as N,a as W,b as I,aa as $,F as E,j as l,ab as H,d as z,ac as J,ad as w,ae as V,af as Y,c as K,p as X,e as Q,as as Z}from"./vendor-1f431ae3.js";import"./constants-62640824.js";import{t as ee}from"./transformPositionToVector3-0d134797.js";import{t as te}from"./transfromToMeshBasicMaterial-0c27a0b0.js";import{g as ne}from"./getInitialParamFromUrl-9191fb83.js";function oe(n,t){const e=t?.size??512,f=t?.fontSize??e*(35/256)*1.2,i=t?.backgroundColor??"rgba(0,0,0,0)",c=t?.fontColor??"#fff",b=t?.textAlign??"center",d=document.createElement("canvas");d.setAttribute("width",e+""),d.setAttribute("height",e+"");const r=d.getContext("2d");return r.fillStyle=i,r.fillRect(0,0,e,e),r.font=`${f}px "\u5FAE\u8F6F\u96C5\u9ED1"`,r.textAlign=b,r.fillStyle=c,r.fillText(n,e/2,e*.7),new L(d)}const ie=(n,t)=>{const e={},f=t.animationEnabled??!0,i=t.position??void 0,c=t.rad??void 0,b=t.fbx_url||"//vrlab-image4.ljcdn.com/release/web/entryDoorMini/Anim_Door1.fbx",d=[],r=async o=>{const u=o?.position??i;if(!u)return Promise.reject("ModelEntryDoorGuidePlugin.load(): position is undefined");const p=ee(u),a=o?.rad??c,x=o?.fbx_url??b;if(e.rad=a,a===void 0)return Promise.reject(`ModelEntryDoorGuidePlugin.load(): rad is ${a}`);const s=await new k().loadAsync(x);s.position.copy(p),s.rotation.z=a,s.scale.set(.8,.8,.8),te(s,{transparent:!0,side:B});const m=s.children?.[0]?.children?.[3]?.clone();return m?(m.material=new U({transparent:!0,map:oe("\u5165\u6237\u95E8")}),m.renderOrder=3,s.children[0].add(m),e.object=s,!0):Promise.reject(`ModelEntryDoorGuidePlugin.load(): textMesh is ${m}`)},G=()=>{if(e.animation)return;if(!e.object)return console.error("ModelEntryDoorGuidePlugin.initAnimation(): state.object is ",e.object);const o=1,u=new q(e.object);d.push(u);const p=u.clipAction(e.object.animations[0]);p.timeScale=o;let a;const x=()=>{let h=0,D=0;const R=1e3/30,P=A=>{h=requestAnimationFrame(P);const F=A-D;F<R||(D=A,d.forEach(O=>O.update(F/1e3)),n.needsRender=!0)};return h=requestAnimationFrame(P),()=>{cancelAnimationFrame(h)}},T={play:()=>{a||(p.play(),a=x(),requestAnimationFrame(()=>{e.object&&e.object.rotation.z!==e.rad&&(e.object.rotation.z=e.rad)}))},stop:()=>{p.stop(),a?.(),a=void 0}};e.animation=T},v=o=>{if(!e.object)return console.error("ModelEntryDoorGuidePlugin.enable(): object is ",e.object);(o?.animationEnable??f)&&(e.animation||G(),e.animation.play()),n.scene.add(e.object),n.needsRender=!0},y=()=>{!e.object||(e.animation&&e.animation.stop(),n.scene.remove(e.object),n.needsRender=!0)},g=o=>o==="Floorplan"?v():y();return{load:r,enable:o=>(e.enabled||(e.enabled=!0,g(n.currentMode),n.on("modeChange",g),v(o)),!0),disable:()=>(e.enabled&&(e.enabled=!1,y(),n.off("modeChange",g)),!0)}};function M(){return{width:window.innerWidth,height:window.innerHeight}}function ae(){const[n,t]=j.exports.useState(M);return j.exports.useEffect(()=>{const e=()=>t(M());return window.addEventListener("resize",e,!1),()=>window.removeEventListener("resize",e,!1)}),n}const re=()=>{const[n,t]=N(),e=W(),f=I(),i=_(C.MODEL_ENTRY_DOOR_GUIDE_PLUGIN_SERVER_DATA);return $("modelLoaded",async()=>{if(!i||JSON.stringify(i)==="{}")return;const c={fbx_url:"//vrlab-image4.ljcdn.com/release/web/entryDoorMini/Anim_Door1.fbx",position:i?.position,rad:i?.rad};await e.plugins.modelEntryDoorGuidePlugin.load(c),t({mode:E.Mode.Floorplan,fov:80,latitude:-.06631286321852166,longitude:2.424613849671955,panoIndex:0}),e.plugins.modelEntryDoorGuidePlugin.enable({animationEnable:!1})},[i]),f!=="Loaded"?null:l(H,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},children:z(J,{showLabels:!0,value:n.mode,onChange:(c,b)=>{t({mode:b})},children:[l(w,{label:"\u5168\u666F\u6F2B\u6E38",icon:l(V,{}),value:E.Mode.Panorama}),l(w,{label:"\u7A7A\u95F4\u603B\u89C8",icon:l(Y,{}),value:E.Mode.Floorplan})]})})},se={},S=ne(),le=JSON.stringify(S)!=="{}"?S:se,de=K({imageOptions:{size:512},textureOptions:{size:512},plugins:[[ie,"modelEntryDoorGuidePlugin",{...le}]]}),ce=()=>{const n=ae(),t=_(C.WORK);return t&&z(de,{initialWork:X(t),ref:e=>Object.assign(window,{$five:e?.five}),children:[l(Q,{...n}),l(re,{})]})};Z.exports.render(l(ce,{}),document.querySelector("#app"));
