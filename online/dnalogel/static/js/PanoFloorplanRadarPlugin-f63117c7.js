import{u as Z,D as $}from"./useFetchDatas-9069443e.js";import{g as W,i as M,h as H,k as L,l as x,m as w,n as g,o as j,q as E,t as F,v as I,w as ee,x as ae,y as R,z as re,E as oe,H as U,I as k,J as P,K as z,L as d,N as v,Q as y,U as ie,X as te,Y as ne,Z as se,_ as le,r as O,u as fe,a as ce,F as N,j as A,B as pe,c as ue,d as me,p as ge,e as he,R as de}from"./vendor-1f431ae3.js";import"./constants-62640824.js";import{C as q,a as _e,b as ve,f as be,c as B}from"./RoomHighlight-2a8d56e9.js";import{t as xe}from"./throttle-19b08aa2.js";import{g as we}from"./getInitialParamFromUrl-9191fb83.js";function je(n){L(n,"svelte-o7uo2v",".plugin-radar__camera-wrapper.svelte-o7uo2v{width:100%;height:100%;position:absolute;pointer-events:none}.plugin-radar__camera-position.svelte-o7uo2v{position:absolute;left:0;top:0;width:0;height:0;transform:none;pointer-events:none;transition:transform 1s linear}.plugin-radar__camera-rotate.svelte-o7uo2v{position:absolute;left:-15px;top:-15px;width:17px;height:17px;transform-origin:15px 15px;transform:rotate(45deg);background-repeat:no-repeat;background-size:100%}")}function Ie(n){let e,t,r;return{c(){e=x("div"),t=x("div"),r=x("div"),w(r,"class","plugin-radar__camera-rotate svelte-o7uo2v"),g(r,"background-image","url("+(n[0]||q)+")"),g(r,"transform",n[1],!1),w(t,"class","plugin-radar__camera-position svelte-o7uo2v"),g(t,"transform",n[2],!1),w(e,"class","plugin-radar__camera-wrapper svelte-o7uo2v")},m(a,o){j(a,e,o),E(e,t),E(t,r)},p(a,[o]){o&1&&g(r,"background-image","url("+(a[0]||q)+")"),o&2&&g(r,"transform",a[1],!1),o&4&&g(t,"transform",a[2],!1)},i:F,o:F,d(a){a&&I(e)}}}function Oe(n,e,t){let{five:r}=e,{pxmm:a}=e,{floorplanData:o}=e,{cameraImageUrl:i}=e;function p(m){const _=o.observers[m],b=o.bounding,h=(b.max.x-b.min.x)*a,S=(b.max.y-b.min.y)*a;if(!_)return"";const C=Math.floor(_.positionInImage.x*h),D=Math.floor(_.positionInImage.y*S);return`translate(${C}px, ${D}px)`}function u(){const{longitude:m}=r.getCurrentState();return`rotate(${Math.floor(m/Math.PI*180)*-1+45}deg)`}const f=m=>{t(2,l=p(m))},s=xe(()=>{t(1,c=u())},1e3/60);let c=u(),l=p(r.getCurrentState().panoIndex);return ee(()=>{r.on("panoWillArrive",f),r.on("cameraDirectionUpdate",s)}),ae(()=>{r.off("panoWillArrive",f),r.off("cameraDirectionUpdate",s)}),n.$$set=m=>{"five"in m&&t(3,r=m.five),"pxmm"in m&&t(4,a=m.pxmm),"floorplanData"in m&&t(5,o=m.floorplanData),"cameraImageUrl"in m&&t(0,i=m.cameraImageUrl)},[i,c,l,r,a,o]}class De extends W{constructor(e){super();M(this,e,Oe,Ie,H,{five:3,pxmm:4,floorplanData:5,cameraImageUrl:0},je)}}function Ee(n){L(n,"svelte-8n0d4v",".plugin-pano-floorplan__extra-objects.svelte-8n0d4v{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none}.plugin-pano-floorplan__extra-object-item--position.svelte-8n0d4v{position:absolute;width:0;height:0}.plugin-pano-floorplan__extra-object-item.svelte-8n0d4v{transform:translate(-50%, -50%)}")}function G(n,e,t){const r=n.slice();return r[1]=e[t],r}function K(n,e){let t,r,a=`${e[1].icon.width/16}rem`,o=`${e[1].icon.height/16}rem`,i,p=`${e[1].positionInImage.y*100}%`,u=`${e[1].positionInImage.x*100}%`;return{key:n,first:null,c(){t=x("div"),r=x("div"),i=R(),w(r,"class","plugin-pano-floorplan__extra-object-item svelte-8n0d4v"),g(r,"background-image",`url(${e[1].icon.url})`),g(r,"width",a,!1),g(r,"height",o,!1),w(t,"class","plugin-pano-floorplan__extra-object-item--position svelte-8n0d4v"),g(t,"top",p,!1),g(t,"left",u,!1),this.first=t},m(f,s){j(f,t,s),E(t,r),E(t,i)},p(f,s){e=f,s&1&&g(r,"background-image",`url(${e[1].icon.url})`),s&1&&a!==(a=`${e[1].icon.width/16}rem`)&&g(r,"width",a,!1),s&1&&o!==(o=`${e[1].icon.height/16}rem`)&&g(r,"height",o,!1),s&1&&p!==(p=`${e[1].positionInImage.y*100}%`)&&g(t,"top",p,!1),s&1&&u!==(u=`${e[1].positionInImage.x*100}%`)&&g(t,"left",u,!1)},d(f){f&&I(t)}}}function ke(n){let e,t=[],r=new Map,a=n[0];const o=i=>i[1].id;for(let i=0;i<a.length;i+=1){let p=G(n,a,i),u=o(p);r.set(u,t[i]=K(u,p))}return{c(){e=x("div");for(let i=0;i<t.length;i+=1)t[i].c();w(e,"class","plugin-pano-floorplan__extra-objects svelte-8n0d4v")},m(i,p){j(i,e,p);for(let u=0;u<t.length;u+=1)t[u].m(e,null)},p(i,[p]){p&1&&(a=i[0],t=re(t,p,o,1,i,a,r,e,oe,K,null,G))},i:F,o:F,d(i){i&&I(e);for(let p=0;p<t.length;p+=1)t[p].d()}}}function Pe(n,e,t){let{extraObjects:r=[]}=e;return n.$$set=a=>{"extraObjects"in a&&t(0,r=a.extraObjects)},[r]}class ye extends W{constructor(e){super();M(this,e,Pe,ke,H,{extraObjects:0},Ee)}}function V(n){let e,t;const r=[{five:n[0],pxmm:n[1],floorIndex:n[2],floorplanData:n[4],onRoomHeightClick:n[6]}];let a={};for(let o=0;o<r.length;o+=1)a=U(a,r[o]);return e=new ve({props:a}),{c(){k(e.$$.fragment)},m(o,i){P(e,o,i),t=!0},p(o,i){const p=i&87?z(r,[{five:o[0],pxmm:o[1],floorIndex:o[2],floorplanData:o[4],onRoomHeightClick:o[6]}]):{};e.$set(p)},i(o){t||(d(e.$$.fragment,o),t=!0)},o(o){v(e.$$.fragment,o),t=!1},d(o){y(e,o)}}}function Se(n){let e,t,r,a,o,i;const p=[{floorIndex:n[2],floorplanData:n[4]}];let u={};for(let s=0;s<p.length;s+=1)u=U(u,p[s]);e=new _e({props:u}),r=new ye({props:{extraObjects:n[5]}});let f=n[3]&&V(n);return{c(){k(e.$$.fragment),t=R(),k(r.$$.fragment),a=R(),f&&f.c(),o=ie()},m(s,c){P(e,s,c),j(s,t,c),P(r,s,c),j(s,a,c),f&&f.m(s,c),j(s,o,c),i=!0},p(s,[c]){const l=c&20?z(p,[{floorIndex:s[2],floorplanData:s[4]}]):{};e.$set(l);const m={};c&32&&(m.extraObjects=s[5]),r.$set(m),s[3]?f?(f.p(s,c),c&8&&d(f,1)):(f=V(s),f.c(),d(f,1),f.m(o.parentNode,o)):f&&(te(),v(f,1,1,()=>{f=null}),ne())},i(s){i||(d(e.$$.fragment,s),d(r.$$.fragment,s),d(f),i=!0)},o(s){v(e.$$.fragment,s),v(r.$$.fragment,s),v(f),i=!1},d(s){y(e,s),s&&I(t),y(r,s),s&&I(a),f&&f.d(s),s&&I(o)}}}function Ce(n,e,t){let r,{five:a}=e,{pxmm:o}=e,{floorIndex:i}=e,{hoverEnable:p}=e,{floorplanData:u}=e,{extraObjects:f=[]}=e;const s=void 0;return n.$$set=c=>{"five"in c&&t(0,a=c.five),"pxmm"in c&&t(1,o=c.pxmm),"floorIndex"in c&&t(2,i=c.floorIndex),"hoverEnable"in c&&t(3,p=c.hoverEnable),"floorplanData"in c&&t(4,u=c.floorplanData),"extraObjects"in c&&t(7,f=c.extraObjects)},n.$$.update=()=>{n.$$.dirty&132&&t(5,r=f?.filter(c=>c.floorIndex===i))},[a,o,i,p,u,r,s,f]}class Fe extends W{constructor(e){super();M(this,e,Ce,Se,H,{five:0,pxmm:1,floorIndex:2,hoverEnable:3,floorplanData:4,extraObjects:7})}}function Re(n){L(n,"svelte-7d8ub2",".plugin-floorplan-radar.svelte-7d8ub2{width:100%;height:100%;display:flex;justify-content:center;align-items:center}.plugin-floorplan-radar-container.svelte-7d8ub2{position:relative}")}function Y(n){let e,t,r,a,o=`${n[7]}px`,i=`${n[10]}px`,p;const u=[{five:n[0],pxmm:n[8],floorIndex:n[9],floorplanData:n[2],hoverEnable:n[1],extraObjects:n[4]}];let f={};for(let l=0;l<u.length;l+=1)f=U(f,u[l]);t=new Fe({props:f});const s=[{pxmm:n[8],five:n[0],floorplanData:n[2],cameraImageUrl:n[3]}];let c={};for(let l=0;l<s.length;l+=1)c=U(c,s[l]);return a=new De({props:c}),{c(){e=x("div"),k(t.$$.fragment),r=R(),k(a.$$.fragment),w(e,"class","plugin-floorplan-radar-container svelte-7d8ub2"),g(e,"width",o,!1),g(e,"height",i,!1)},m(l,m){j(l,e,m),P(t,e,null),E(e,r),P(a,e,null),p=!0},p(l,m){const _=m&791?z(u,[{five:l[0],pxmm:l[8],floorIndex:l[9],floorplanData:l[2],hoverEnable:l[1],extraObjects:l[4]}]):{};t.$set(_);const b=m&269?z(s,[{pxmm:l[8],five:l[0],floorplanData:l[2],cameraImageUrl:l[3]}]):{};a.$set(b),m&128&&o!==(o=`${l[7]}px`)&&g(e,"width",o,!1),m&1024&&i!==(i=`${l[10]}px`)&&g(e,"height",i,!1)},i(l){p||(d(t.$$.fragment,l),d(a.$$.fragment,l),p=!0)},o(l){v(t.$$.fragment,l),v(a.$$.fragment,l),p=!1},d(l){l&&I(e),y(t),y(a)}}}function Ue(n){let e,t,r,a=n[5]!==0&&Y(n);return{c(){e=x("div"),a&&a.c(),w(e,"class","plugin-floorplan-radar svelte-7d8ub2"),se(()=>n[11].call(e))},m(o,i){j(o,e,i),a&&a.m(e,null),t=le(e,n[11].bind(e)),r=!0},p(o,[i]){o[5]!==0?a?(a.p(o,i),i&32&&d(a,1)):(a=Y(o),a.c(),d(a,1),a.m(e,null)):a&&(te(),v(a,1,1,()=>{a=null}),ne())},i(o){r||(d(a),r=!0)},o(o){v(a),r=!1},d(o){o&&I(e),a&&a.d(),t()}}}function ze(n,e,t){let{five:r}=e,{hoverEnable:a}=e,{floorplanData:o}=e,{cameraImageUrl:i}=e,{extraObjects:p=[]}=e,u=0,f=0,s=0,c=0,l=0,m=0;function _(h){t(9,f=r.work.observers[h].floorIndex)}ee(()=>(r.on("panoArrived",_),()=>{r.off("panoArrived",_)}));function b(){s=this.clientWidth,c=this.clientHeight,t(5,s),t(6,c)}return n.$$set=h=>{"five"in h&&t(0,r=h.five),"hoverEnable"in h&&t(1,a=h.hoverEnable),"floorplanData"in h&&t(2,o=h.floorplanData),"cameraImageUrl"in h&&t(3,i=h.cameraImageUrl),"extraObjects"in h&&t(4,p=h.extraObjects)},n.$$.update=()=>{if(n.$$.dirty&228){const h=Math.min(s,c),{max:S,min:C}=o.bounding,D=S.x-C.x,T=S.y-C.y,J=function(){return D>T?[h,h/D*T]:[h/T*D,h]}();t(7,l=J[0]),t(10,m=J[1]),t(8,u=l/D)}},[r,a,o,i,p,s,c,l,u,f,m,b]}class Ae extends W{constructor(e){super();M(this,e,ze,Ue,H,{five:0,hoverEnable:1,floorplanData:2,cameraImageUrl:3,extraObjects:4},Re)}}class We{app;five;wrapperSelector="";data;wrapper=null;extraObjects;originExtraObjects;configs={};constructor(e,t){this.five=e,t?.configs&&Object.assign(this.configs,t.configs),typeof t?.wrapper=="string"?this.wrapperSelector=t.wrapper:t?.wrapper instanceof Element&&(this.wrapper=t.wrapper),e.once("dispose",this.dispose)}dispose=()=>{this.app?.$destroy()};load=async e=>{const t=JSON.parse(JSON.stringify(e)),r=await be(t);this.data=r,this.render()};appendTo(e){this.wrapper=e,this.render()}changeConfigs(e){Object.assign(this.configs,e),this.render()}setExtraObjectsWith3DPositions(e){this.originExtraObjects=e,this.data&&(this.extraObjects=B(e,this.five,this.data),this.render())}render(){if(!this.wrapper){const t=document.querySelector(this.wrapperSelector);this.wrapper=t}if(!this.data||!this.wrapper)return;!this.extraObjects&&this.originExtraObjects&&(this.extraObjects=B(this.originExtraObjects,this.five,this.data));const e={five:this.five,floorplanData:this.data,extraObjects:this.extraObjects,cameraImageUrl:this.configs.cameraImageUrl,hoverEnable:this.configs.hoverEnable??!1};if(!this.app){this.app=new Ae({target:this.wrapper,props:e});return}this.app.$set(e)}}const Me=(n,e)=>new We(n,e);function Q(){return{width:window.innerWidth,height:window.innerHeight}}function He(){const[n,e]=O.exports.useState(Q);return O.exports.useEffect(()=>{const t=()=>e(Q());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),n}const Te=()=>{const[n,e]=fe(),t=Z($.FLOOR_PLAN_SERVER_PLUGIN_DATA),r=ce(),a=O.exports.useRef(null),[o,i]=O.exports.useState(!1);return O.exports.useEffect(()=>{!a.current||n.mode!==N.Mode.Panorama||r.plugins.panoFloorplanRadarPlugin.appendTo(a.current)},[]),O.exports.useEffect(()=>{!t||JSON.stringify(t)==="{}"||r.plugins.panoFloorplanRadarPlugin.load(t)},[t]),O.exports.useEffect(()=>{n.mode===N.Mode.Panorama?i(!0):i(!1)},[n.mode]),A(pe,{onClick:()=>e({mode:N.Mode.Floorplan}),sx:{display:`${o?"flex":"none"}`,justifyContent:"center",alignItems:"center",position:"absolute",top:"60px",right:"20px",padding:"10px",width:"90px",height:"120px",backgroundColor:"rgba(0, 0, 0, .2)"},ref:a})},Ne={},X=we(),Le=JSON.stringify(X)!=="{}"?X:Ne,Je=ue({imageOptions:{size:512},textureOptions:{size:512},plugins:[[Me,"panoFloorplanRadarPlugin",{...Le}]]}),qe=()=>{const n=He(),e=Z($.WORK);return e&&me(Je,{initialWork:ge(e),ref:t=>Object.assign(window,{$five:t?.five}),children:[A(he,{...n}),A(Te,{})]})};de.render(A(qe,{}),document.querySelector("#app"));
