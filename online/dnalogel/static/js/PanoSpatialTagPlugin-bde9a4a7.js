import{u as Ee,D as Me}from"./useFetchDatas-9069443e.js";import{aJ as Ze,g as ke,i as xe,h as Ae,k as Ie,l as W,m as A,a7 as Y,n as E,o as re,a2 as Le,v as ce,U as ze,t as ne,ag as He,y as ee,q as x,w as Ue,aK as Ve,x as qe,a5 as Be,aA as Ge,V as O,aL as pe,ak as ue,F as le,a9 as Je,aM as Xe,r as J,u as Ke,a as De,b as Qe,j as G,B as $e,c as et,d as tt,p as at,e as nt,R as ot}from"./vendor-1f431ae3.js";import{M as it}from"./index-0d39624f.js";import"./constants-62640824.js";import{C as st}from"./index-d016ea8c.js";import{g as lt}from"./getInitialParamFromUrl-9191fb83.js";import"./transformPositionToVector3-0d134797.js";const Re=Ze(null);function rt(a){Ie(a,"svelte-scnx9u",".PanoSpatialTagPlugin__tag-origin.svelte-scnx9u{position:absolute;width:0.5rem;height:0.5rem;border-radius:50%;background:#fff;box-shadow:0 0 .6rem #fff;transform:translate(-50%, -50%) scale(1);transform-origin:center center;animation:svelte-scnx9u-PanoSpatialTagPlugin__tag-origin 1.2s forwards;pointer-events:auto}.PanoSpatialTagPlugin__tag-origin.svelte-scnx9u:after{content:'';position:absolute;top:50%;height:50%;width:2rem;height:2rem;transform:translate(-50%, -50%)}.PanoSpatialTagPlugin__tag-origin-destroy.svelte-scnx9u{transform:translate(-50%, -50%) scale(0.6);animation:svelte-scnx9u-PanoSpatialTagPlugin__tag-origin-destroy 1.2s forwards .7s}@keyframes svelte-scnx9u-PanoSpatialTagPlugin__tag-origin{0%{transform:translate(-50%, -50%) scale(1);opacity:0}100%{transform:translate(-50%, -50%) scale(0.6);opacity:1 }}@keyframes svelte-scnx9u-PanoSpatialTagPlugin__tag-origin-destroy{0%{transform:translate(-50%, -50%) scale(0.6);opacity:1}10%{transform:translate(-50%, -50%) scale(1);opacity:0.9}100%{transform:translate(-50%, -50%) scale(1);opacity:0}}")}function fe(a,e,t){const o=a.slice();return o[3]=e[t],o}function he(a){let e,t=`${a[3].top}%`,o=`${a[3].left}%`,i,l;function s(){return a[2](a[3])}return{c(){e=W("i"),A(e,"class","svelte-scnx9u"),Y(e,"PanoSpatialTagPlugin__tag-origin",!0),Y(e,"PanoSpatialTagPlugin__tag-origin-destroy",a[3].destroying),E(e,"top",t,!1),E(e,"left",o,!1),E(e,"visibility",a[3].front?"visible":"hidden",!1)},m(u,w){re(u,e,w),i||(l=Le(e,"click",s),i=!0)},p(u,w){a=u,w&1&&Y(e,"PanoSpatialTagPlugin__tag-origin-destroy",a[3].destroying),w&1&&t!==(t=`${a[3].top}%`)&&E(e,"top",t,!1),w&1&&o!==(o=`${a[3].left}%`)&&E(e,"left",o,!1),w&1&&E(e,"visibility",a[3].front?"visible":"hidden",!1)},d(u){u&&ce(e),i=!1,l()}}}function ct(a){let e,t=a[0],o=[];for(let i=0;i<t.length;i+=1)o[i]=he(fe(a,t,i));return{c(){for(let i=0;i<o.length;i+=1)o[i].c();e=ze()},m(i,l){for(let s=0;s<o.length;s+=1)o[s].m(i,l);re(i,e,l)},p(i,[l]){if(l&3){t=i[0];let s;for(s=0;s<t.length;s+=1){const u=fe(i,t,s);o[s]?o[s].p(u,l):(o[s]=he(u),o[s].c(),o[s].m(e.parentNode,e))}for(;s<o.length;s+=1)o[s].d(1);o.length=t.length}},i:ne,o:ne,d(i){He(o,i),i&&ce(e)}}}function gt(a,e,t){let{origins:o}=e;const i=s=>{Re.update(()=>`${s}-PanoSpatialTagPlugin-${Date.now()}`)},l=s=>i(s.id);return a.$$set=s=>{"origins"in s&&t(0,o=s.origins)},[o,i,l]}class dt extends ke{constructor(e){super();xe(this,e,gt,ct,Ae,{origins:0},rt)}}function pt(a){Ie(a,"svelte-14w1wha",".PanoSpatialTagPlugin__tag-x.svelte-14w1wha.svelte-14w1wha{position:relative;display:block;white-space:nowrap;box-sizing:border-box;width:25rem;height:14rem;color:#FFF;transform:translate(0, -100%);transition:height .5s linear}.PanoSpatialTagPlugin__tag-shadow.svelte-14w1wha.svelte-14w1wha{content:'';position:absolute;width:30rem;height:30rem;top:-15rem;left:-15rem;z-index:-1;opacity:0;transition:opacity .8s .6s;background:url('https://vrlab-image4.ljcdn.com/release/web/PanoSpatialTagPlugin__blur.png');background-size:30rem 30rem}.PanoSpatialTagPlugin__tag-line.svelte-14w1wha.svelte-14w1wha{position:absolute;left:-1rem;width:2rem;height:100%;overflow:hidden}.PanoSpatialTagPlugin__tag-flagpole.svelte-14w1wha.svelte-14w1wha{position:absolute;top:0;left:1rem;height:calc(100% - 1.5rem);width:.15rem;background:linear-gradient(to bottom, rgba(255, 255, 255, 1), rgba(255, 255, 255, .1));box-shadow:0 .1rem .5rem rgba(0, 0, 0, .2);opacity:0;transform:translate(-50%, 60%) scaleY(0);transition:transform .4s cubic-bezier(.44,.44,.74,.98) , opacity .4s cubic-bezier(.44,.44,.74,.98), width .5s linear, height .5s linear ;transform-origin:center bottom}.PanoSpatialTagPlugin__tag-line1.svelte-14w1wha.svelte-14w1wha{position:absolute;top:0;left:0.5rem;height:1.8rem;width:.1rem;background:#fff;opacity:0;transform:translate(-50%, 200%) scaleY(0);transform-origin:center top}.PanoSpatialTagPlugin__tag-line2.svelte-14w1wha.svelte-14w1wha{position:absolute;top:0;left:0.3rem;height:1.8rem;width:.1rem;background:#fff;opacity:0;transform:translate(-50%, 200%) scaleY(0);transform-origin:center top}.PanoSpatialTagPlugin__tag-show.svelte-14w1wha .PanoSpatialTagPlugin__tag-line1.svelte-14w1wha{animation:svelte-14w1wha-PanoSpatialTagPlugin__tag-line1 linear .5s forwards .45s}.PanoSpatialTagPlugin__tag-show.svelte-14w1wha .PanoSpatialTagPlugin__tag-line2.svelte-14w1wha{animation:svelte-14w1wha-PanoSpatialTagPlugin__tag-line2 linear .5s forwards .65s}.PanoSpatialTagPlugin__tag-x.PanoSpatialTagPlugin__tag-upside-down.svelte-14w1wha.svelte-14w1wha{transform:translate(0, 0)}.PanoSpatialTagPlugin__tag-upside-down.svelte-14w1wha .PanoSpatialTagPlugin__tag-line.svelte-14w1wha{transform:scaleY(-1)}.PanoSpatialTagPlugin__tag-animate.svelte-14w1wha.svelte-14w1wha{position:relative;height:100%;overflow:hidden;transform-origin:left top;transition:transform .5s linear}.PanoSpatialTagPlugin__tag-upside-down.svelte-14w1wha .PanoSpatialTagPlugin__tag-animate.svelte-14w1wha{transform-origin:left bottom}.PanoSpatialTagPlugin__tag-content.svelte-14w1wha.svelte-14w1wha{position:absolute;display:inline-block;transform:translate(-100%, 0);transition:transform .9s cubic-bezier(0,.65,.16,1.08) .6s;padding-left:.5rem;font-size:1rem}.PanoSpatialTagPlugin__tag-upside-down.svelte-14w1wha .PanoSpatialTagPlugin__tag-content.svelte-14w1wha{bottom:0}.PanoSpatialTagPlugin__tag-show.svelte-14w1wha .PanoSpatialTagPlugin__tag-flagpole.svelte-14w1wha{opacity:1;transform:translate(-50%, 0) scaleY(1)}.PanoSpatialTagPlugin__tag-upside-down.svelte-14w1wha .PanoSpatialTagPlugin__tag-shadow.svelte-14w1wha{top:unset;bottom:-15rem}.PanoSpatialTagPlugin__tag-show.svelte-14w1wha .PanoSpatialTagPlugin__tag-shadow.svelte-14w1wha{opacity:.32}.PanoSpatialTagPlugin__tag-show.svelte-14w1wha .PanoSpatialTagPlugin__tag-content.svelte-14w1wha{transform:translate(0, 0)}.PanoSpatialTagPlugin__tag-hide.svelte-14w1wha .PanoSpatialTagPlugin__tag-flagpole.svelte-14w1wha{opacity:0;transform:translate(-50%, 60%) scaleY(0);transition:transform .5s .55s, opacity .4s .55s}.PanoSpatialTagPlugin__tag-hide.svelte-14w1wha .PanoSpatialTagPlugin__tag-shadow.svelte-14w1wha{opacity:0;transition:opacity .8s}.PanoSpatialTagPlugin__tag-hide.svelte-14w1wha .PanoSpatialTagPlugin__tag-content.svelte-14w1wha{transform:translate(-100%, 0);transition:transform .6s cubic-bezier(.53,.06,.88,.59)}.PanoSpatialTagPlugin__tag-hide.svelte-14w1wha .PanoSpatialTagPlugin__tag-content .svelte-14w1wha{pointer-events:none}.PanoSpatialTagPlugin__tag-hide.svelte-14w1wha .PanoSpatialTagPlugin__tag-line1.svelte-14w1wha{opacity:0.5;transform:translate(-50%, 10%) scaleY(0);animation:svelte-14w1wha-PanoSpatialTagPlugin__tag-line1-hide linear .28s forwards .3s}.PanoSpatialTagPlugin__tag-hide.svelte-14w1wha .PanoSpatialTagPlugin__tag-line2.svelte-14w1wha{opacity:0.5;transform:translate(-50%, 0) scaleY(0);animation:svelte-14w1wha-PanoSpatialTagPlugin__tag-line2-hide linear .28s forwards .45s}@keyframes svelte-14w1wha-PanoSpatialTagPlugin__tag-line1{0%{opacity:0;transform:translate(-50%, 250%) scaleY(1)}50%{opacity:0.5;transform:translate(-50%, 135%) scaleY(1)}100%{opacity:0.5;transform:translate(-50%, 20%) scaleY(0)}}@keyframes svelte-14w1wha-PanoSpatialTagPlugin__tag-line2{0%{opacity:0;transform:translate(-50%, 250%) scaleY(1)}50%{opacity:0.5;transform:translate(-50%, 125%) scaleY(1)}100%{opacity:0.5;transform:translate(-50%, 0) scaleY(0)}}@keyframes svelte-14w1wha-PanoSpatialTagPlugin__tag-line1-hide{0%{opacity:0.5;transform:translate(-50%, 10%) scaleY(0)}50%{opacity:0.2;transform:translate(-50%, 105%) scaleY(1)}100%{opacity:0;transform:translate(-50%, 200%) scaleY(0)}}@keyframes svelte-14w1wha-PanoSpatialTagPlugin__tag-line2-hide{0%{opacity:0.5;transform:translate(-50%, 0) scaleY(0)}50%{opacity:0.2;transform:translate(-50%, 100%) scaleY(1)}100%{opacity:0;transform:translate(-50%, 200%) scaleY(0)}}")}function ut(a){let e,t,o,i,l,s,u,w,S,T,M,n,v,I,C;return{c(){e=W("div"),t=W("div"),o=ee(),i=W("div"),l=W("i"),s=ee(),u=W("i"),w=ee(),S=W("i"),T=ee(),M=W("div"),n=W("div"),A(t,"class","PanoSpatialTagPlugin__tag-shadow svelte-14w1wha"),E(t,"transform","translate("+a[7]/2*a[3]*3+"px, "+a[8]/2*(a[1]?-1:1)*a[3]*3+"px)"),A(l,"class","PanoSpatialTagPlugin__tag-flagpole svelte-14w1wha"),E(l,"width",a[4]+"rem"),A(u,"class","PanoSpatialTagPlugin__tag-line1 svelte-14w1wha"),A(S,"class","PanoSpatialTagPlugin__tag-line2 svelte-14w1wha"),A(i,"class","PanoSpatialTagPlugin__tag-line svelte-14w1wha"),A(n,"class","PanoSpatialTagPlugin__tag-content svelte-14w1wha"),A(M,"class","PanoSpatialTagPlugin__tag-animate svelte-14w1wha"),E(M,"transform","scale("+a[3]*3+")"),A(e,"id",v="PanoSpatialTagPlugin__"+a[0]),E(e,"height",20*a[5]+"rem"),A(e,"class","svelte-14w1wha"),Y(e,"PanoSpatialTagPlugin__tag-x",!0),Y(e,"PanoSpatialTagPlugin__tag-upside-down",a[1]),Y(e,"PanoSpatialTagPlugin__tag-show",a[10]),Y(e,"PanoSpatialTagPlugin__tag-hide",a[10]===!1||a[6])},m(d,h){re(d,e,h),x(e,t),x(e,o),x(e,i),x(i,l),x(i,s),x(i,u),x(i,w),x(i,S),x(e,T),x(e,M),x(M,n),n.innerHTML=a[2],a[16](n),I||(C=Le(n,"click",a[11]),I=!0)},p(d,[h]){h&394&&E(t,"transform","translate("+d[7]/2*d[3]*3+"px, "+d[8]/2*(d[1]?-1:1)*d[3]*3+"px)"),h&16&&E(l,"width",d[4]+"rem"),h&4&&(n.innerHTML=d[2]),h&8&&E(M,"transform","scale("+d[3]*3+")"),h&1&&v!==(v="PanoSpatialTagPlugin__"+d[0])&&A(e,"id",v),h&32&&E(e,"height",20*d[5]+"rem"),h&2&&Y(e,"PanoSpatialTagPlugin__tag-upside-down",d[1]),h&1024&&Y(e,"PanoSpatialTagPlugin__tag-show",d[10]),h&1088&&Y(e,"PanoSpatialTagPlugin__tag-hide",d[10]===!1||d[6])},i:ne,o:ne,d(d){d&&ce(e),a[16](null),I=!1,C()}}}function ft(a,e,t){let{id:o}=e,{upsideDown:i}=e,{content:l}=e,{contentZoom:s}=e,{lineWidthZoom:u}=e,{lineHeightZoom:w}=e,{destroying:S=!1}=e,{folded:T}=e,{dispose:M}=e,{events:n}=e,{hooks:v}=e,I=0,C=0,d,h,F=setTimeout(()=>{T||t(10,h=!0),F=void 0},100);const N=g=>{const H=Object.keys(n);let L=g.target;for(;L;){const U=L.getAttribute("class");if(!U){L=L.parentNode;continue}if(U.includes("PanoSpatialTagPlugin__tag-content")){L=null;break}H.forEach(X=>{U.includes(X)&&n[X](o)}),L=L.parentNode}};Ue(()=>{v.emit("initTag",{id:o})});const oe=Re.subscribe(g=>{if(g===null)return;const[H,L]=g.split("-PanoSpatialTagPlugin-");o===H&&(v.emit("clickOrigin",{id:o,show:h}),F||(t(10,h=T),t(12,T=!T),F=setTimeout(()=>{F=void 0},1500)))});Ve(()=>{t(7,I=d.offsetWidth),t(8,C=d.offsetHeight),!F&&t(10,h=!T)}),qe(()=>{v.emit("destroyTag",{id:o}),oe(),M()});function ie(g){Be[g?"unshift":"push"](()=>{d=g,t(9,d)})}return a.$$set=g=>{"id"in g&&t(0,o=g.id),"upsideDown"in g&&t(1,i=g.upsideDown),"content"in g&&t(2,l=g.content),"contentZoom"in g&&t(3,s=g.contentZoom),"lineWidthZoom"in g&&t(4,u=g.lineWidthZoom),"lineHeightZoom"in g&&t(5,w=g.lineHeightZoom),"destroying"in g&&t(6,S=g.destroying),"folded"in g&&t(12,T=g.folded),"dispose"in g&&t(13,M=g.dispose),"events"in g&&t(14,n=g.events),"hooks"in g&&t(15,v=g.hooks)},[o,i,l,s,u,w,S,I,C,d,h,N,T,M,n,v,ie]}class ht extends ke{constructor(e){super();xe(this,e,ft,ut,Ae,{id:0,upsideDown:1,content:2,contentZoom:3,lineWidthZoom:4,lineHeightZoom:5,destroying:6,folded:12,dispose:13,events:14,hooks:15},pt)}}const mt={position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",pointerEvents:"none"},me="<",we=">",_e="%",Pe="locals",wt="(<%%|%%>|<%=|<%-|<%_|<%#|<%|%>|-%>|_%>)",_t={"&":"&amp","<":"&lt",">":"&gt",'"':"&#34","'":"&#39"},b={EVAL:"eval",ESCAPED:"escaped",RAW:"raw",COMMENT:"comment",LITERAL:"literal"};function Te(a){return a.replace(/;(\s*$)/,"$1")}function Pt(a,e){return new Tt(a).compileFunction()(e)}class Tt{templateText;mode=null;truncate=!1;currentLine=1;source="";regex=new RegExp(wt);constructor(e){this.templateText=e}compileFunction(){let e;const t=`  var __output = "";
  function __append(s) { if (s !== undefined && s !== null) __output += s }
  with (`+Pe+` || {}) {
`,o=`  }
  return __output;
`,i=function(l){return l==null?"":String(l).replace(/[&<>'"]/g,function(s){return _t[s]||s})};return this._generateSource(),this.source=t+this.source+o,e=this.source,e="escapeFn = escapeFn || "+i.toString()+`;
`+e,new Function(Pe+", escapeFn",e)}_generateSource(){this.templateText=this.templateText.replace(/[ \t]*<%_/gm,"<%_").replace(/_%>[ \t]*/gm,"_%>");const e=this._parseTemplateText(),t=_e,o=me,i=we;e&&e.length&&e.forEach((l,s)=>{let u;if(l.indexOf(o+t)===0&&l.indexOf(o+t+t)!==0&&(u=e[s+2],!(u==t+i||u=="-"+t+i||u=="_"+t+i)))throw new Error('Could not find matching close tag for "'+l+'".');this._scanLine(l)})}_parseTemplateText(){let e=this.templateText;const t=this.regex;let o=t.exec(e);const i=[];let l;for(;o;)l=o.index,l!==0&&(i.push(e.substring(0,l)),e=e.slice(l)),i.push(o[0]),e=e.slice(o[0].length),o=t.exec(e);return e&&i.push(e),i}_addOutput(e){if(this.truncate&&(e=e.replace(/^(?:\r\n|\r|\n)/,""),this.truncate=!1),!e)return e;e=e.replace(/\\/g,"\\\\"),e=e.replace(/\n/g,"\\n"),e=e.replace(/\r/g,"\\r"),e=e.replace(/"/g,'\\"'),this.source+='    ; __append("'+e+`")
`}_scanLine(e){const t=_e,o=me,i=we;switch(e.split(`
`).length-1,e){case o+t:case o+t+"_":this.mode=b.EVAL;break;case o+t+"=":this.mode=b.ESCAPED;break;case o+t+"-":this.mode=b.RAW;break;case o+t+"#":this.mode=b.COMMENT;break;case o+t+t:this.mode=b.LITERAL,this.source+='    ; __append("'+e.replace(o+t+t,o+t)+`")
`;break;case t+t+i:this.mode=b.LITERAL,this.source+='    ; __append("'+e.replace(t+t+i,t+i)+`")
`;break;case t+i:case"-"+t+i:case"_"+t+i:this.mode==b.LITERAL&&this._addOutput(e),this.mode=null,this.truncate=e.indexOf("-")===0||e.indexOf("_")===0;break;default:if(this.mode){switch(this.mode){case b.EVAL:case b.ESCAPED:case b.RAW:e.lastIndexOf("//")>e.lastIndexOf(`
`)&&(e+=`
`)}switch(this.mode){case b.EVAL:this.source+="    ; "+e+`
`;break;case b.ESCAPED:this.source+="    ; __append(escapeFn("+Te(e)+`))
`;break;case b.RAW:this.source+="    ; __append("+Te(e)+`)
`;break;case b.COMMENT:break;case b.LITERAL:this._addOutput(e);break}}else this._addOutput(e)}}}const se=.001,te=1.4,ve=.01,vt="https://vrlab-image4.ljcdn.com/release/web/PanoSpatialTagPlugin__blur.png",ae=1.2,R=3.5,bt=(a,e)=>{let t=e?.container;const o=e?.wait??200,i=e?.maxNumberOnScreen??3,l=e?.minRad??Math.PI/4,s=e?.nearTolerance??100,u=e?.upsideHeight??1.6,w=st(a),S=document.createElement("div");S.classList.add("PanoSpatialTagPlugin"),Object.assign(S.style,mt);const T=new Ge;let M=new Image;M.src=vt;const n={points:[],origins:[],tags:[],template:"",events:{},render:Pt,folded:!1,enabled:!0,forbidden:!0},v=new dt({target:S,props:{origins:n.origins}}),I=(r,f)=>{F(),f&&N()},C=()=>{n.forbidden&&(n.forbidden=!1,N())},d=(r,f)=>{if(n.tags.length===0)return;const k=f.longitude-a.state.longitude,c=a.camera.clone();c.position.copy(f.offset),c.rotateOnWorldAxis(new O(0,1,0),k),c.updateProjectionMatrix(),c.updateMatrixWorld(!0);const j=new pe,V=new ue;V.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),j.setFromProjectionMatrix(V),n.tags.forEach(p=>{const K=c.position.clone().setY(te).distanceTo(p.position);if(K<ae||K>R||!j.containsPoint(p.position))return p.destroying=!0;const q=p.position.clone().sub(c.position).setY(0);if(q.angleTo(p.normal)>Math.PI/2-l&&q.angleTo(p.normal)<Math.PI/2+l)return p.destroying=!0}),n.tags.forEach(p=>{p.destroying?p.app.$set({contentZoom:.1+c.position.distanceTo(p.position)/R,lineWidthZoom:.38*(.01+c.position.distanceTo(p.position)/R),destroying:p.destroying}):p.app.$set({lineWidthZoom:.38*(.01+c.position.distanceTo(p.position)/R),lineHeightZoom:.4+(c.position.distanceTo(p.position)-ae)/R*.6,contentZoom:.1+c.position.distanceTo(p.position)/R})}),setTimeout(()=>{n.tags.forEach(p=>{p.destroying&&(p.app.$destroy(),p=null)}),n.tags=n.tags.filter(p=>!p.destroying),F()},1900)},h=r=>{r!==le.Mode.Panorama&&!n.forbidden&&(v.$set({origins:[]}),n.tags.forEach(f=>{f.app.$destroy(),f=null}),n.origins=[],n.tags=[],n.forbidden=!0)},F=()=>{if(n.forbidden||!n.enabled)return;const r=a.camera,f=r.getWorldDirection(new O);n.origins=n.tags.map(k=>{const c=k.position.clone().project(r),j=k.position.clone().sub(r.position).setY(0).angleTo(f.setY(0))<Math.PI/2;return{id:k.id,front:j,left:(c.x+1)/2*100,top:(-c.y+1)/2*100,destroying:k.destroying}}),v.$set({origins:n.origins})},N=()=>{n.forbidden||!n.enabled||(n.timeoutId&&clearTimeout(n.timeoutId),n.timeoutId=setTimeout(()=>{n.timeoutId=void 0;const r=oe();r.length&&(n.tags=n.tags.concat(r),F())},o))},oe=()=>{const{clientWidth:r,clientHeight:f}=a.getElement(),k=[],c=a.camera,j=new pe,V=new ue,p=c.getWorldDirection(new O);V.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),j.setFromProjectionMatrix(V);const K=n.tags.filter(_=>j.containsPoint(_.position)&&!_.destroying).length,q=n.points.reduce((_,y)=>{if(n.tags.find(P=>y.id===P.id&&!P.destroying))return _;const D=c.position.clone().setY(te).distanceTo(y.position);if(D<ae||D>R||!j.containsPoint(y.position))return _;const B=y.position.clone().sub(c.position).setY(0);if(B.angleTo(y.normal)>Math.PI/2-l&&B.angleTo(y.normal)<Math.PI/2+l)return _;const Q=y.position.clone().project(c);if(!n.tags.every(P=>{if(P.position.clone().sub(c.position).setY(0).angleTo(p.setY(0))>Math.PI/2)return!0;const z=P.position.clone().project(c);return Math.sqrt(Math.pow((Q.x-z.x)/2*r,2)+Math.pow((Q.y-z.y)/2*f,2))>s}))return _;const Z={id:y.id,position:y.position,normal:y.normal,replacement:y.replacement,weight:y.weight,distance:D};let m;for(let P=0,z=_.length;P<z;P++){const $=_[P];if(Z.weight>$.weight){m=P;break}if(Z.distance<$.distance){m=P;break}}return m!==void 0?_.splice(m,0,Z):_.push(Z),_},[]);for(let _=0,y=q.length;_<y&&!(K+k.length>=i);_++){const D=q[_];if(k.find(m=>D.id===m.id))continue;const B=D.position.clone().project(c);if(!n.tags.concat(k).every(m=>{if(m.position.clone().sub(c.position).setY(0).angleTo(p.setY(0))>Math.PI/2)return!0;const P=m.position.clone().project(c);return Math.sqrt(Math.pow((B.x-P.x)/2*r,2)+Math.pow((B.y-P.y)/2*f,2))>s}))continue;const Q=new Je(c.position.clone().setY(te),D.position.clone().sub(c.position.clone().setY(te)).normalize(),0,D.distance+ve),[Z]=a.model.intersectRaycaster(Q);if(!!Z&&D.distance-Z.distance<ve){const{position:m,normal:P,id:z,replacement:$}=D,Ce=new Xe().setFromNormalAndCoplanarPoint(P,m),de=m.clone().sub(c.position).cross(new O(0,1,0)).setLength(se),Fe=[m.clone(),m.clone().add(de),m.clone().add(new O(0,se,0)).add(de),m.clone().add(new O(0,se,0))].map(Ne=>Ce.projectPoint(Ne,new O)),{container:Oe,dispose:We}=w.create3DDomContainer(Fe)||{},je=new ht({target:Oe,props:{id:z,content:n.render(n.template,$),lineWidthZoom:.38*(.01+c.position.distanceTo(m)/R),lineHeightZoom:.4+(c.position.distanceTo(m)-ae)/R*.6,contentZoom:.1+c.position.distanceTo(m)/R,upsideDown:m.y>u,folded:n.folded,events:n.events,hooks:T,dispose:We}});k.push({position:m,normal:P,id:z,app:je})}}return k},ie=r=>{n.points=r.points.map(f=>({id:f.id,position:new O().fromArray(f.position),normal:new O().fromArray(f.normal),replacement:f.replacement??{},weight:f.weight??-1})),r.render&&(n.render=r.render),r.template&&(n.template=r.template),r.events&&(n.events=r.events),r.enabled===!1&&(n.enabled=r.enabled),r.folded===!0&&(n.folded=r.folded)},g=()=>{n.enabled=!0,N()},H=()=>{n.enabled=!1,v.$set({origins:[]}),n.tags.forEach(r=>{r.app.$destroy(),r=null}),n.origins=[],n.tags=[]},L=()=>{n.folded=!1,n.tags.forEach(r=>{r.app.$set({folded:n.folded})})},U=()=>{n.folded=!0,n.tags.forEach(r=>{r.app.$set({folded:n.folded})})},X=r=>{n.tags.forEach(f=>{f.id===r&&f.app.$set({folded:!1})})},Ye=r=>{n.tags.forEach(f=>{f.id===r&&f.app.$set({folded:!0})})},ge=()=>{M=null,w.disposeAll(),v.$destroy(),n.tags.forEach(r=>{r.app.$destroy(),r=null}),n.origins=[],n.tags=[],a.off("panoWillArrive",d),a.off("panoArrived",C),a.off("modeChange",h),a.off("cameraUpdate",I)};return a?.model?.loaded?(t||(t=a.getElement().parentElement),t.appendChild(S),n.forbidden=!1,N(),a.on("panoWillArrive",d),a.on("panoArrived",C),a.on("modeChange",h),a.on("cameraUpdate",I)):a.once("modelBvhLoaded",()=>{t||(t=a.getElement().parentElement),t.appendChild(S),n.forbidden=!1,N(),a.on("panoWillArrive",d),a.on("panoArrived",C),a.on("modeChange",h),a.on("cameraUpdate",I)}),a.on("dispose",ge),{load:ie,unfoldAll:L,foldAll:U,unfold:X,fold:Ye,enable:g,disable:H,hooks:T,dispose:ge}};function be(){return{width:window.innerWidth,height:window.innerHeight}}function St(){const[a,e]=J.exports.useState(be);return J.exports.useEffect(()=>{const t=()=>e(be());return window.addEventListener("resize",t,!1),()=>window.removeEventListener("resize",t,!1)}),a}const yt=()=>{const[a,e]=Ke(),t=De(),o=J.exports.useRef(null),i=Qe();return J.exports.useEffect(()=>{!o.current||a.mode!==le.Mode.Panorama||t.plugins.modelViewPlugin.appendTo(o.current,{width:90,height:120})},[a.mode,i]),a.mode!==le.Mode.Panorama||i!=="Loaded"?null:G($e,{onClick:()=>e({mode:"Floorplan"}),sx:{display:"flex",justifyContent:"center",alignItems:"center",position:"absolute",top:"60px",right:"20px",padding:"10px",width:"110px",height:"140px",boxSizing:"border-box",backgroundColor:"rgba(0, 0, 0, .2)"},ref:o})},Et=()=>{const a=De(),e=Ee(Me.MODEL_TAG,"81gmMq5eXl5I9y7JMk");return J.exports.useEffect(()=>{if(!e)return;const t=e.map(o=>{const{id:i,position:l,normal:s,weight:u,name:w,price:S,brand:T}=o;return{id:i,position:l,normal:s,weight:u,replacement:{name:w,price:S,brand:T}}});a.plugins.panoSpatialTagPlugin.load({points:t,template:`
            <div class="tag-wrapper" style="pointer-events: auto;">
              <%if (brand) {%><div style="background:url('//vrlab-static.ljcdn.com/release/web/brand_bg.15e354d0.png') no-repeat;background-size:100% 100%;box-shadow: 0 -0.625rem 0.625rem 0 rgba(0, 0, 0, 0.1);
                border-radius: 0.0625rem;overflow: hidden;font-size: 0.6875rem;padding:0.125rem;width:max-content;margin-bottom:0.375rem;line-height:1;">
                <%= brand %>
              </div><% } %>
              <div style="max-width:7rem;overflow:hidden;white-space: nowrap;text-overflow: ellipsis;line-height:1;margin-bottom:0.375rem;"><%= name %></div>
              <%if (price) {%><div style="display:flex;align-items:center;font-family: Helvetica;font-size: 0.9375rem;font-weight:600;line-height:1;color: #ffdda1;text-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.1);">
                <svg height="12" viewBox="0 0 10 12" width="10" xmlns="http://www.w3.org/2000/svg">
                  <path d="m6.30970149 6.49402985h1.82910448v1.2761194h-2.12686567v3.50223885h-2.45298508v-3.50223885h-2.12686567v-1.2761194h1.82910448l-3.26119403-6.49402985h2.60895522l2.16940299 5.3738806 2.2119403-5.3738806h2.50970149z" fill="#ffdda1" transform="translate(.182 .682)"/>
                </svg>
                <span><%= price %></span>
              </div>
              <% } %>
            </div>`,events:{"tag-wrapper":o=>{a.plugins.panoSpatialTagPlugin.fold(o)}}})},[e]),null},Mt={},Se=lt(),ye=JSON.stringify(Se)!=="{}"?Se:Mt,kt=et({plugins:[[bt,"panoSpatialTagPlugin",{...ye}],[it,"modelViewPlugin",{...ye}]]}),xt=()=>{const a=St(),e=Ee(Me.WORK,"81gmMq5eXl5I9y7JMk");return e&&tt(kt,{initialWork:at(e),ref:t=>Object.assign(window,{$five:t?.five}),children:[G(nt,{...a}),G(Et,{}),G(yt,{})]})};ot.render(G(xt,{}),document.querySelector("#app"));
