import{u as O,D as L}from"./useFetchDatas-b277a088.js";import{ar as U,an as q,ao as N,aq as W,as as I,r as z,u as $,a as H,b as J,a9 as V,F as S,j as b,aa as Y,d as k,ab as K,ac as G,ad as X,ae as Q,c as Z,p as ee,e as ne,f as oe}from"./vendor-b2bf1e8d.js";import"./typings-ddaad332.js";import{t as te}from"./transformPositionToVector3-27356c9f.js";import{t as ie}from"./transfromToMeshBasicMaterial-5433e41f.js";import{g as re}from"./getInitialParamFromUrl-141e6748.js";function ae(t,n){var i,d,r,e,f;const u=(i=n==null?void 0:n.size)!==null&&i!==void 0?i:512,F=(d=n==null?void 0:n.fontSize)!==null&&d!==void 0?d:u*(35/256)*1.2,j=(r=n==null?void 0:n.backgroundColor)!==null&&r!==void 0?r:"rgba(0,0,0,0)",E=(e=n==null?void 0:n.fontColor)!==null&&e!==void 0?e:"#fff",w=(f=n==null?void 0:n.textAlign)!==null&&f!==void 0?f:"center",p=document.createElement("canvas");p.setAttribute("width",u+""),p.setAttribute("height",u+"");const c=p.getContext("2d");return c.fillStyle=j,c.fillRect(0,0,u,u),c.font=`${F}px "\u5FAE\u8F6F\u96C5\u9ED1"`,c.textAlign=w,c.fillStyle=E,c.fillText(t,u/2,u*.7),new U(p)}const le=(t,n)=>{var i,d,r;const e={},f=(i=n.animationEnabled)!==null&&i!==void 0?i:!0,u=(d=n.position)!==null&&d!==void 0?d:void 0,F=(r=n.rad)!==null&&r!==void 0?r:void 0,j=n.fbx_url||"//vrlab-image4.ljcdn.com/release/web/entryDoorMini/Anim_Door1.fbx",E=[],w=async o=>{var a,m,l,h,y,D,g;const _=(a=o==null?void 0:o.position)!==null&&a!==void 0?a:u;if(!_)return Promise.reject("ModelEntryDoorGuidePlugin.load(): position is undefined");const P=te(_),x=(m=o==null?void 0:o.rad)!==null&&m!==void 0?m:F,A=(l=o==null?void 0:o.fbx_url)!==null&&l!==void 0?l:j;if(e.rad=x,x===void 0)return Promise.reject(`ModelEntryDoorGuidePlugin.load(): rad is ${x}`);const s=await new q().loadAsync(A);s.position.copy(P),s.rotation.z=x,s.scale.set(.8,.8,.8),ie(s,{transparent:!0,side:N});const v=(g=(D=(y=(h=s.children)===null||h===void 0?void 0:h[0])===null||y===void 0?void 0:y.children)===null||D===void 0?void 0:D[3])===null||g===void 0?void 0:g.clone();return v?(v.material=new W({transparent:!0,map:ae("\u5165\u6237\u95E8")}),v.renderOrder=3,s.children[0].add(v),e.object=s,!0):Promise.reject(`ModelEntryDoorGuidePlugin.load(): textMesh is ${v}`)},p=()=>{if(e.animation)return;if(!e.object)return console.error("ModelEntryDoorGuidePlugin.initAnimation(): state.object is ",e.object);const o=1,a=new I(e.object);E.push(a);const m=a.clipAction(e.object.animations[0]);m.timeScale=o;let l;const h=()=>{let _=0,P=0;const x=1e3/30,A=s=>{_=requestAnimationFrame(A);const v=s-P;v<x||(P=s,E.forEach(B=>B.update(v/1e3)),t.needsRender=!0)};return _=requestAnimationFrame(A),()=>{cancelAnimationFrame(_)}},g={play:()=>{l||(m.play(),l=h(),requestAnimationFrame(()=>{e.object&&e.object.rotation.z!==e.rad&&(e.object.rotation.z=e.rad)}))},stop:()=>{m.stop(),l==null||l(),l=void 0}};e.animation=g},c=o=>{var a;if(!e.object)return console.error("ModelEntryDoorGuidePlugin.enable(): object is ",e.object);((a=o==null?void 0:o.animationEnable)!==null&&a!==void 0?a:f)&&(e.animation||p(),e.animation.play()),t.scene.add(e.object),t.needsRender=!0},C=()=>{!e.object||(e.animation&&e.animation.stop(),t.scene.remove(e.object),t.needsRender=!0)},M=o=>o==="Floorplan"?c():C();return{load:w,enable:o=>(e.enabled||(e.enabled=!0,M(t.currentMode),t.on("modeChange",M),c(o)),!0),disable:()=>(e.enabled&&(e.enabled=!1,C(),t.off("modeChange",M)),!0)}};function T(){return{width:window.innerWidth,height:window.innerHeight}}function se(){const[t,n]=z.exports.useState(T);return z.exports.useEffect(()=>{const i=()=>n(T());return window.addEventListener("resize",i,!1),()=>window.removeEventListener("resize",i,!1)}),t}const de=()=>{const[t,n]=$(),i=H(),d=J(),r=O(L.MODEL_ENTRY_DOOR_GUIDE_PLUGIN_SERVER_DATA);return V("modelLoaded",async()=>{if(!r||JSON.stringify(r)==="{}")return;const e={fbx_url:"//vrlab-image4.ljcdn.com/release/web/entryDoorMini/Anim_Door1.fbx",position:r?.position,rad:r?.rad};await i.plugins.modelEntryDoorGuidePlugin.load(e),n({mode:S.Mode.Floorplan,fov:80,latitude:-.06631286321852166,longitude:2.424613849671955,panoIndex:0}),i.plugins.modelEntryDoorGuidePlugin.enable({animationEnable:!1})},[r]),d!=="Loaded"?null:b(Y,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:"transparent"},children:k(K,{showLabels:!0,value:t.mode,onChange:(e,f)=>{n({mode:f})},children:[b(G,{label:"\u5168\u666F\u6F2B\u6E38",icon:b(X,{}),value:S.Mode.Panorama}),b(G,{label:"\u7A7A\u95F4\u603B\u89C8",icon:b(Q,{}),value:S.Mode.Floorplan})]})})},ue={},R=re(),ce=JSON.stringify(R)!=="{}"?R:ue,me=Z({imageOptions:{size:512},textureOptions:{size:512},plugins:[[le,"modelEntryDoorGuidePlugin",{...ce}]]}),ve=()=>{const t=se(),n=O(L.WORK);return n&&k(me,{initialWork:ee(n),ref:i=>Object.assign(window,{$five:i?.five}),children:[b(ne,{...t}),b(de,{})]})};oe.exports.render(b(ve,{}),document.querySelector("#app"));
