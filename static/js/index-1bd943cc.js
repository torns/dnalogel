import{V as c,S as q,at as I,au as T,aq as j,ao as H,av as L,M as N}from"./vendor-b2bf1e8d.js";import{t as V}from"./transformPositionToVector3-27356c9f.js";function R(n,e){const b=Math.round(n);return b%2===0?b:b+Number((e==null?void 0:e.smaller)?-1:1)}function U(n,e){return new c((n.x+e.x)/2,(n.y+e.y)/2,(n.z+e.z)/2)}function X(n,e){if(!e||typeof ResizeObserver>"u")return{observe:()=>window.addEventListener("resize",n),unobserve:()=>window.removeEventListener("resize",n)};{const b=new ResizeObserver(n);return{observe:()=>b.observe(e),unobserve:()=>b.unobserve(e)}}}const B=n=>{const e={disposeCallbacks:[]},b=(...t)=>{var x,u,w;const m=t[0].map(s=>s instanceof c?s:V(s)),o=t[1];if((m==null?void 0:m.length)<4)return console.error("points must be equal or greater than than 4");if(!((x=n==null?void 0:n.model)===null||x===void 0?void 0:x.loaded))return console.error("five.model.loaded is: ",(u=n==null?void 0:n.model)===null||u===void 0?void 0:u.loaded);const v=n.getElement();if(!v)return console.error("five.getElement() is "+v);const D=[],C=(o==null?void 0:o.ratio)||.00216;C<=.00215&&console.warn("if you need click css3DElement on safari, ratio must be greater than 0.00215");const A=(o==null?void 0:o.dpr)||1,r=(o==null?void 0:o.mode)||"front",y=(w=o==null?void 0:o.autoRender)!==null&&w!==void 0?w:!0,i=(o==null?void 0:o.behindFiveContainer)||v.parentElement||document.body,h=(o==null?void 0:o.container)||document.createElement("div");h.classList.add("__Dnalogel-plugin--CSS3DRenderPlugin");const{css3DObject:g,mesh:E}=W(m,{ratio:C,dpr:A,container:h,mode:r});let d;const S=r==="front"&&!e.frontMode,z=r==="behind"&&!e.behindMode,O=!(S||z);z&&(e.behindMode={scene:new q,css3DRenderer:new I}),S&&(e.frontMode={scene:new q,css3DRenderer:new I});const l=r==="behind"?e.behindMode:e.frontMode,{scene:f,css3DRenderer:a}=l,P=(()=>{if(O)return()=>{f.add(g)};{const s=()=>{const p=R(v.clientWidth,{smaller:!0}),_=R(v.clientHeight,{smaller:!0});a.setSize(p,_)};s(),d=X(s,v),a.domElement.style.position="absolute",a.domElement.style.top="0",a.domElement.style.userSelect="none",a.domElement.style.pointerEvents="none";const M=()=>{const p=requestAnimationFrame(M);l.requestAnimationFrameId=p,a.render(f,n.camera)};return()=>{var p;f.add(g),(p=d==null?void 0:d.observe)===null||p===void 0||p.call(d),M(),r==="behind"&&E&&(n.scene.add(E),D.push(()=>E&&n.scene.remove(E)))}}})();S&&(v.parentElement||document.body).appendChild(a.domElement),z&&i.appendChild(a.domElement);const F=()=>{var s;return D.forEach(M=>M==null?void 0:M()),f.remove(g),f.children.length===0&&(typeof l.requestAnimationFrameId=="number"&&cancelAnimationFrame(l.requestAnimationFrameId),a.domElement.remove(),r==="front"&&(e.frontMode=void 0),r==="behind"&&(e.behindMode=void 0),!e.behindMode&&!e.frontMode&&((s=d==null?void 0:d.unobserve)===null||s===void 0||s.call(d))),!0},k=e.disposeCallbacks.findIndex(s=>s===F);return k!==-1?e.disposeCallbacks.splice(k,1):e.disposeCallbacks.push(F),y&&P(),{container:h,dispose:F,css3DObject:g,render:y?void 0:P}},W=(t,x)=>{const{ratio:u,dpr:w,container:m,mode:o}=x,v=t[0].distanceTo(t[1]),D=t[1].distanceTo(t[2]),C=R(v/u*w),A=R(D/u*w),r=new T(m);r.scale.set(u,u,u),m.style.width=C+"px",m.style.height=A+"px",m.style.pointerEvents="none";const y=U(t[0],t[2]),i=t[1].clone().sub(t[0]),h=t[2].clone().sub(t[1]),g=new c(0,1,0).angleTo(new c(0,h.y,h.z)),E=new c(1,0,0).angleTo(new c(i.x,0,i.z)),d=i.angleTo(new c(i.x,0,i.z)),S=(h.z>0?-1:1)*g,z=(i.z<0?1:-1)*E,O=(i.x>0&&i.y<0||i.x<0&&i.y>0?-1:1)*d;r.rotateOnWorldAxis(new c(1,0,0),S),r.rotateOnWorldAxis(new c(0,1,0),z),r.rotateOnWorldAxis(new c(0,0,1),O),r.position.set(y.x,y.y,y.z);let l;if(o==="behind"){const f=new j({opacity:0,transparent:!1,side:H}),a=new L(C,A);l=new N(a,f),l.name="CSS3DRenderPlugin-mesh",l.position.copy(r.position),l.rotation.copy(r.rotation),l.scale.copy(r.scale)}return{css3DObject:r,mesh:l}};return{create3DDomContainer:b,disposeAll:()=>{e.disposeCallbacks.forEach(t=>t==null?void 0:t()),e.disposeCallbacks=[]}}};export{B as C};
